<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP Agendei7</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind CSS Config -->
    <script>
      tailwind.config = {
        darkMode: 'class'
      }
    </script>
    // --- CONEXÃO COM O BACKEND (GOOGLE APPS SCRIPT) ---
// URL do seu script publicado como aplicativo web.
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzVSGkDZmhLXQPR8lnswoBxthzlEEgNocTTdKS71ok6B2rZvzY7yujOGzLci4-B-GCC/exec';

// Objeto que centraliza todas as chamadas para o backend.
const api = {
    /**
     * Função genérica e interna para fazer uma chamada ao Google Apps Script.
     * @param {string} action - O nome da ação que você quer executar no backend (ex: 'login').
     * @param {object} payload - Os dados que você quer enviar (ex: { login: 'admin', senha: '123' }).
     */
    _callApi: async function(action, payload = {}) {
        try {
            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                redirect: "follow",
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8', // Necessário para evitar erros de CORS com Apps Script
                },
                body: JSON.stringify({ action, payload }) // Envia a ação e os dados em um único objeto
            });

            if (!response.ok) {
                throw new Error(`Erro de rede: ${response.statusText}`);
            }
            
            const result = await response.json(); // Converte a resposta do backend para JSON
            
            // Verifica se o backend retornou um status de erro
            if (result.status === 'error') {
                console.error('Erro retornado pela API:', result.message);
                throw new Error(result.message);
            }
            
            // Se tudo deu certo, retorna os dados
            return result.data;

        } catch (error) {
            console.error(`Falha na chamada da API para a ação "${action}":`, error);
            throw error; // Joga o erro para que o componente que chamou a função saiba que algo deu errado
        }
    },

    // Funções específicas para cada ação no backend.
    // Elas usam a função _callApi para fazer o trabalho pesado.
    login: function(login, password) {
        return this._callApi('login', { login, password });
    },

    getInitialData: function() {
        return this._callApi('getInitialData');
    },
    
    addEvent: function(eventData, currentUser) {
        return this._callApi('addEvent', { eventData, currentUser });
    },

    // ... e assim por diante para todas as outras ações (updateEvent, deleteEvent, etc.)
};
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- PWA Manifest -->
    <link rel="manifest" id="manifest">

    <!-- Theme Color -->
    <meta name="theme-color" content="#6d28d9">

    <!-- Icons -->
    <link rel="apple-touch-icon" href="icon-192x192.png">

    <style>
        /* Estilo para a animação de carregamento */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #6d28d9;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Animação para o Modal */
        @keyframes fade-in-scale {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-fade-in-scale {
            animation: fade-in-scale 0.2s ease-out forwards;
        }

        /* Animação para o Toast */
        @keyframes fade-in-out {
            0% { opacity: 0; transform: translateY(20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(20px); }
        }
        .animate-fade-in-out {
            animation: fade-in-out 3s ease-in-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        
        // --- Componente da Logo (recriada em SVG a partir da imagem do usuário) ---
        const UserAppLogo = ({ className }) => (
            <svg viewBox="0 0 180 180" className={className} xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <clipPath id="rounded-corners">
                        <rect width="180" height="180" rx="35" ry="35" />
                    </clipPath>
                </defs>
                <g clipPath="url(#rounded-corners)">
                    <rect width="180" height="180" fill="#6d28d9" />
                    
                    {/* Calendário */}
                    <path d="M45,40 a10,10 0 0,1 10,-10 h70 a10,10 0 0,1 10,10 v70 a10,10 0 0,1 -10,10 h-70 a10,10 0 0,1 -10,-10 Z" fill="white"/>
                    <rect x="45" y="55" width="90" height="8" fill="#6d28d9"/>
                    <rect x="62" y="22" width="12" height="20" rx="5" fill="white"/>
                    <rect x="106" y="22" width="12" height="20" rx="5" fill="white"/>
                    
                    {/* Checkmark */}
                    <path d="M60 95 l20 20 l45 -45" stroke="#6d28d9" strokeWidth="12" fill="none" strokeLinecap="round" strokeLinejoin="round" />

                    {/* Texto */}
                    <text x="90" y="155" fontFamily="Arial, sans-serif" fontSize="24" fill="white" textAnchor="middle" fontWeight="bold">Agendei7</text>
                </g>
            </svg>
        );


        // --- Mock Data (Dados Estáticos) ---
        const MOCK_USERS_DATA = {
            'admin': { id: 'admin', name: 'Admin', email: 'admin@agendei7.com', senha: 'admin', avatar: 'https://placehold.co/100x100/ef4444/ffffff?text=AD' },
            'u1': { id: 'u1', name: 'Ana Beatriz', email: 'ana@agendei7.com', senha: '123', avatar: 'https://placehold.co/100x100/6366f1/ffffff?text=AB' },
            'u2': { id: 'u2', name: 'Carlos Daniel', email: 'carlos@agendei7.com', senha: '456', avatar: 'https://placehold.co/100x100/ec4899/ffffff?text=CD' },
            'u3': { id: 'u3', name: 'Fernanda Lima', email: 'fernanda@agendei7.com', senha: '789', avatar: 'https://placehold.co/100x100/f59e0b/ffffff?text=FL' },
            'u4': { id: 'u4', name: 'Ricardo Neves', email: 'ricardo@agendei7.com', senha: 'abc', avatar: 'https://placehold.co/100x100/10b981/ffffff?text=RN' },
            'u5': { id: 'u5', name: 'Juliana Paes', email: 'juliana@agendei7.com', senha: 'def', avatar: 'https://placehold.co/100x100/3b82f6/ffffff?text=JP' },
        };
        
        const MOCK_EVENTS_DATA = [
            { id: 'evt1', name: 'Culto de Celebração', date: '2025-10-26', time: '10:00', location: 'Salão Principal', description: 'Celebração dominical com louvor, palavra e comunhão.', status: 'Aberta', eventType: 'Culto', serviceType: 'Celebração', department: 'MINISTERIO DA MUSICA', responsible: 'Sérgio',
                musicDetails: {
                    nomeCantor: 'Ana Beatriz',
                    integrante1: 'Carlos Daniel', integrante2: 'Fernanda Lima', integrante3: 'Ricardo Neves', integrante4: '',
                    musica1: 'Grande é o Senhor', musica2: 'A Ele a Glória', musica3: '', musica4: ''
                },
                logInfo: { RE_DATA_UPDATE: '15/10/2025 10:00', RE_DATA_MODIFICACAO: '15/10/2025 10:00', RE_USUARIO_LOGADO: 'Admin' }
            },
            { id: 'evt2', name: 'Ensaio do Ministério de Louvor', date: '2025-10-31', time: '20:00', location: 'Sala de Música', description: 'Ensaio semanal para preparação dos cânticos.', status: 'Fechada', eventType: 'Ensaio', serviceType: 'N/A', department: 'MINISTERIO DA MUSICA', responsible: 'Sérgio', logInfo: { RE_DATA_UPDATE: '15/10/2025 10:05', RE_DATA_MODIFICACAO: '15/10/2025 10:05', RE_USUARIO_LOGADO: 'Admin' } },
            { id: 'evt3', name: 'Ação Social Comunitária', date: '2025-11-08', time: '09:00', location: 'Pátio da Igreja', description: 'Distribuição de cestas básicas e roupas para a comunidade local.', status: 'Aberta', eventType: 'Ação Social', serviceType: 'N/A', department: 'Social', responsible: 'Jocemara', logInfo: { RE_DATA_UPDATE: '16/10/2025 14:20', RE_DATA_MODIFICACAO: '16/10/2025 14:20', RE_USUARIO_LOGADO: 'Admin' } },
            { id: 'evt4', name: 'Vigília de Oração', date: '2025-11-14', time: '22:00', location: 'Salão Principal', description: 'Uma noite dedicada à oração e busca pela presença de Deus.', status: 'Em Andamento', eventType: 'Culto', serviceType: 'Vigília', department: 'Intercessão', responsible: 'Sebastian', logInfo: { RE_DATA_UPDATE: '17/10/2025 08:00', RE_DATA_MODIFICACAO: '17/10/2025 08:00', RE_USUARIO_LOGADO: 'Admin' } },
            { id: 'evt5', name: 'Reunião de Planejamento', date: '2025-10-26', time: '19:00', location: 'Sala 2', description: 'Planejamento das atividades do próximo mês.', status: 'Planejada', eventType: 'Reunião', serviceType: 'N/A', department: 'SECRETARIA', responsible: 'Admin', logInfo: { RE_DATA_UPDATE: '17/10/2025 08:15', RE_DATA_MODIFICACAO: '17/10/2025 08:15', RE_USUARIO_LOGADO: 'Admin' } }
        ];

        const MOCK_SCALES_DATA = [
            { id: 's1', eventId: 'evt1', name: 'Vocal Principal', slots: 2 }, { id: 's2', eventId: 'evt1', name: 'Mesa de Som', slots: 1 },
            { id: 's3', eventId: 'evt1', name: 'Recepção e Diaconia', slots: 4 }, { id: 's4', eventId: 'evt1', name: 'Projeção (Datashow)', slots: 1 },
            { id: 's5', eventId: 'evt2', name: 'Violão', slots: 1 }, { id: 's6', eventId: 'evt2', name: 'Vocal de Apoio', slots: 3 },
            { id: 's7', eventId: 'evt3', name: 'Montagem das Tendas', slots: 5 }, { id: 's8', eventId: 'evt3', name: 'Distribuição de Alimentos', slots: 8 },
            { id: 's9', eventId: 'evt3', name: 'Aconselhamento', slots: 3 }, { id: 's10', eventId: 'evt4', name: 'Leitura Bíblica', slots: 2 },
            { id: 's11', eventId: 'evt4', name: 'Condução do Louvor', slots: 1 },
        ];

        const MOCK_ASSIGNMENTS = {
            's1': ['u1', 'u2'], 's2': ['u4'], 's3': ['u3'], 's6': ['u5'], 's8': ['u1', 'u3', 'u4'],
        };
        
        const ALL_DEPARTMENTS_NAMES = ['DIACONATO', 'MINISTERIO DA MUSICA', 'MINISTERIO INFANTIL', 'SECRETARIA', 'Social', 'Intercessão', 'Mídia'];

        const MOCK_DEPARTMENTS_DATA = {
            'dept1': { DE_ID_DEPTO: 'dept1', DE_NOME_DEPARTAMENTO: 'DIACONATO', DE_LIDER_DEPTO: 'João Silva', DE_ASSOCIADO_DEPTO: 'Maria Souza', DE_CONTATO: '11912345678', DE_ANCIAO_LIDER: 'Carlos Pereira', DE_EMAIL: 'diaconato@agendei7.com', logInfo: { RE_DATA_UPDATE: '10/10/2025 09:00', RE_DATA_MODIFICACAO: '10/10/2025 09:00', RE_USUARIO_LOGADO: 'Admin' } },
            'dept2': { DE_ID_DEPTO: 'dept2', DE_NOME_DEPARTAMENTO: 'MINISTERIO DA MUSICA', DE_LIDER_DEPTO: 'Sérgio Santos', DE_ASSOCIADO_DEPTO: 'Ana Beatriz', DE_CONTATO: '11923456789', DE_ANCIAO_LIDER: 'Roberto Lima', DE_EMAIL: 'musica@agendei7.com', logInfo: { RE_DATA_UPDATE: '10/10/2025 09:05', RE_DATA_MODIFICACAO: '10/10/2025 09:05', RE_USUARIO_LOGADO: 'Admin' } },
            'dept3': { DE_ID_DEPTO: 'dept3', DE_NOME_DEPARTAMENTO: 'MINISTERIO INFANTIL', DE_LIDER_DEPTO: 'Fernanda Lima', DE_ASSOCIADO_DEPTO: 'Juliana Paes', DE_CONTATO: '11934567890', DE_ANCIAO_LIDER: 'Carlos Pereira', DE_EMAIL: 'infantil@agendei7.com', logInfo: { RE_DATA_UPDATE: '11/10/2025 11:30', RE_DATA_MODIFICACAO: '11/10/2025 11:30', RE_USUARIO_LOGADO: 'Admin' } },
        };
        
        const MOCK_ACCESS_DATA = {
            'acc1': { AC_ID: 'acc1', AC_LOGIN: 'ana.beatriz', AC_SENHA: '***', AC_DEPARTAMENTO: 'MINISTERIO DA MUSICA', AC_RESP: 'Ana Beatriz', AC_EMAIL: 'ana@agendei7.com', AC_APROVACAO: 'A', AC_NOTIFICACAO: 'Acesso total ao módulo de música.', logInfo: { RE_DATA_UPDATE: '12/10/2025 15:00', RE_DATA_MODIFICACAO: '12/10/2025 15:00', RE_USUARIO_LOGADO: 'Admin' } },
            'acc2': { AC_ID: 'acc2', AC_LOGIN: 'carlos.daniel', AC_SENHA: '***', AC_DEPARTAMENTO: 'MINISTERIO DA MUSICA', AC_RESP: 'Carlos Daniel', AC_EMAIL: 'carlos@agendei7.com', AC_APROVACAO: 'P', AC_NOTIFICACAO: 'Aguardando aprovação do líder.', logInfo: { RE_DATA_UPDATE: '13/10/2025 10:00', RE_DATA_MODIFICACAO: '13/10/2025 10:00', RE_USUARIO_LOGADO: 'Admin' } },
            'acc3': { AC_ID: 'acc3', AC_LOGIN: 'jocemara.s', AC_SENHA: '***', AC_DEPARTAMENTO: 'Social', AC_RESP: 'Jocemara', AC_EMAIL: 'social@agendei7.com', AC_APROVACAO: 'I', AC_NOTIFICACAO: 'Usuário inativo desde 01/10/2025.', logInfo: { RE_DATA_UPDATE: '01/09/2025 18:00', RE_DATA_MODIFICACAO: '01/10/2025 12:00', RE_USUARIO_LOGADO: 'Admin' } }
        };


        // --- Componentes da UI ---
        const Header = ({ title, onBack }) => (
            <header className="bg-white dark:bg-gray-800 shadow-md dark:shadow-gray-700 sticky top-0 z-10">
                <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div className="flex items-center justify-between h-16">
                        {onBack ? (
                            <button onClick={onBack} className="text-violet-600 hover:text-violet-800 dark:text-violet-400 dark:hover:text-violet-300 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                        ) : <div className="w-6"></div>}
                        <h1 className="text-xl font-bold text-gray-800 dark:text-gray-200">{title}</h1>
                        <div className="w-6"></div>
                    </div>
                </div>
            </header>
        );
        
        const ConfirmationModal = ({ modalInfo, onConfirm, onCancel }) => {
            if (!modalInfo.isOpen) return null;
            
            const { title, message, confirmText, confirmColor } = modalInfo;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 transition-opacity duration-300">
                    <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-sm animate-fade-in-scale">
                        <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-4">{title}</h3>
                        <p className="text-gray-600 dark:text-gray-400 mb-6">{message}</p>
                        <div className="flex justify-end gap-3">
                            <button onClick={onCancel} className="bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-500 transition">
                                Cancelar
                            </button>
                            <button onClick={onConfirm} className={`text-white font-semibold py-2 px-4 rounded-lg text-sm transition ${confirmColor}`}>
                                {confirmText}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const NotificationChoiceModal = ({ isOpen, departmentName, onSendEmail, onSendWhatsApp, onClose }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
                    <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-sm text-center animate-fade-in-scale">
                        <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">Notificar Departamento</h3>
                        <p className="text-gray-600 dark:text-gray-400 mb-6">Como deseja notificar o departamento <span className="font-semibold">{departmentName}</span>?</p>
                        <div className="flex flex-col gap-3">
                            <button onClick={onSendWhatsApp} className="w-full flex items-center justify-center gap-2 bg-green-500 text-white font-semibold py-3 px-4 rounded-lg text-sm hover:bg-green-600 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                                WhatsApp
                            </button>
                            <button onClick={onSendEmail} className="w-full flex items-center justify-center gap-2 bg-blue-500 text-white font-semibold py-3 px-4 rounded-lg text-sm hover:bg-blue-600 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" /><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" /></svg>
                                E-mail
                            </button>
                            <button onClick={onClose} className="w-full bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-500 transition">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const LoadingModal = ({ isOpen, message }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4">
                    <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 w-full max-w-sm text-center flex flex-col items-center">
                        <div className="loader mb-4"></div>
                        <p className="text-gray-700 dark:text-gray-300 font-semibold">{message}</p>
                    </div>
                </div>
            );
        };
        
        const InfoToast = ({ isVisible, message }) => {
            if (!isVisible) return null;
            return (
                <div className="fixed bottom-20 left-1/2 -translate-x-1/2 bg-green-500 text-white py-2 px-6 rounded-full shadow-lg z-50 animate-fade-in-out">
                    {message}
                </div>
            );
        };

        const SuccessModal = ({ isOpen, title, message, onAddNew, onGoToDashboard }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
                    <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-sm text-center animate-fade-in-scale">
                        <div className="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 dark:bg-green-900 mb-4">
                            <svg className="h-6 w-6 text-green-600 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">{title}</h3>
                        <p className="text-gray-600 dark:text-gray-400 mb-6">{message}</p>
                        <div className="flex flex-col gap-3">
                            <button onClick={onAddNew} className="w-full bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 transition">
                                Inserir Novo Agendamento
                            </button>
                            <button onClick={onGoToDashboard} className="w-full bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-500 transition">
                                Retornar para tela inicial
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const UpdateResultModal = ({ status, onRetry, onGoBack, logMessage }) => {
            if (status === 'idle' || status === 'loading') return null;

            const isSuccess = status === 'success';
            
            return (
                 <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
                    <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md text-center animate-fade-in-scale">
                        <div className={`mx-auto flex items-center justify-center h-12 w-12 rounded-full mb-4 ${isSuccess ? 'bg-green-100 dark:bg-green-900' : 'bg-red-100 dark:bg-red-900'}`}>
                            {isSuccess ? (
                                <svg className="h-6 w-6 text-green-600 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" />
                                </svg>
                            ) : (
                                <svg className="h-6 w-6 text-red-600 dark:text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            )}
                        </div>
                        <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">{isSuccess ? "Atualização Concluída!" : "Falha na Atualização"}</h3>
                        <p className="text-gray-600 dark:text-gray-400 mb-6">{isSuccess ? "Os dados da tabela foram atualizados com sucesso." : "Ocorreu um erro ao tentar atualizar os dados."}</p>
                        
                        {!isSuccess && logMessage && (
                            <div className="bg-gray-100 dark:bg-gray-700 rounded-lg p-3 text-left text-xs text-gray-700 dark:text-gray-300 font-mono mb-6 overflow-x-auto">
                                <p className="font-semibold mb-1">Log do Erro:</p>
                                <pre>{logMessage}</pre>
                            </div>
                        )}

                        <div className="flex flex-col gap-3">
                           {isSuccess ? (
                                <>
                                    <button onClick={onRetry} className="w-full bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 transition">
                                        Realizar Novo Update
                                    </button>
                                     <button onClick={onGoBack} className="w-full bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-500 transition">
                                        Voltar para Configurações
                                    </button>
                                </>
                           ) : (
                                <>
                                    <button onClick={onRetry} className="w-full bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 transition">
                                        Tentar Novamente
                                    </button>
                                     <button onClick={onGoBack} className="w-full bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-500 transition">
                                        Voltar
                                    </button>
                                </>
                           )}
                        </div>
                    </div>
                </div>
            )
        };


        const BottomNav = ({ activeView, setView }) => {
            const navItems = [
                { id: 'dashboard', icon: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />, label: 'Início' },
                { id: 'calendar', icon: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />, label: 'Calendário' },
                { id: 'profile', icon: <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />, label: 'Perfil' },
            ];
            
            return (
                <div className="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 shadow-t border-t border-gray-200 dark:border-gray-700 max-w-4xl mx-auto">
                    <div className="flex justify-around h-16">
                        {navItems.map(item => (
                            <button key={item.id} onClick={() => setView(item.id)} className={`flex flex-col items-center justify-center w-full transition ${activeView === item.id ? 'text-violet-600 dark:text-violet-400' : 'text-gray-500 dark:text-gray-400 hover:text-violet-600 dark:hover:text-violet-400'}`}>
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">{item.icon}</svg>
                                <span className="text-xs mt-1">{item.label}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const EventCard = ({ event, onClick }) => {
            const eventDate = new Date(event.date + 'T00:00:00');
            const day = eventDate.getDate();
            const month = eventDate.toLocaleString('pt-BR', { month: 'short' }).replace('.', '');

            return (
                <div onClick={onClick} className="bg-white dark:bg-gray-800 rounded-lg shadow-md flex items-center p-4 space-x-4 cursor-pointer hover:shadow-lg transition">
                    <div className="flex flex-col items-center justify-center bg-violet-100 dark:bg-violet-900/50 rounded-lg w-16 h-16 text-violet-700 dark:text-violet-300">
                        <span className="text-xs font-bold uppercase">{month}</span>
                        <span className="text-2xl font-bold">{day}</span>
                    </div>
                    <div className="flex-1">
                        <h3 className="font-bold text-gray-800 dark:text-gray-200">{event.name}</h3>
                        <p className="text-sm text-gray-500 dark:text-gray-400">{event.time} - {event.location}</p>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                    </svg>
                </div>
            );
        };

        // --- Telas (Views) ---

        const LoginPage = ({ onLogin }) => {
            const [login, setLogin] = useState('admin');
            const [password, setPassword] = useState('admin');
            const [showPassword, setShowPassword] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                const success = await onLogin(login, password);
                if (!success) {
                    setError('Login ou senha inválidos.');
                }
            };

            return (
                <div className="min-h-screen bg-violet-700 flex flex-col justify-center items-center p-4">
                    <UserAppLogo className="w-48 h-48 mb-6" />
                    <div className="w-full max-w-sm bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl">
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label htmlFor="login" className="block text-black dark:text-white text-sm font-bold mb-2">Login</label>
                                <input 
                                    type="text" 
                                    id="login" 
                                    value={login}
                                    onChange={(e) => setLogin(e.target.value)}
                                    className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-2 focus:ring-violet-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                            </div>
                            <div className="mb-4">
                                <label htmlFor="password"className="block text-black dark:text-white text-sm font-bold mb-2">Senha</label>
                                <div className="relative">
                                    <input 
                                        type={showPassword ? "text" : "password"} 
                                        id="password" 
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-2 focus:ring-violet-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                                    <button 
                                      type="button" 
                                      onClick={() => setShowPassword(!showPassword)} 
                                      className="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5"
                                    >
                                        {showPassword ? (
                                           <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l18 18" /></svg>
                                        ) : (
                                           <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.522 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                                        )}
                                    </button>
                                </div>
                            </div>
                             {error && <p className="text-red-500 text-xs italic mb-4">{error}</p>}
                            <div className="mb-6">
                                <a href="#" onClick={(e) => e.preventDefault()} className="inline-block align-baseline font-bold text-sm text-violet-600 dark:text-violet-400 hover:text-violet-800 dark:hover:text-violet-300">
                                    Esqueceu a senha?
                                </a>
                            </div>
                            <div className="flex items-center justify-between">
                                <button type="submit" className="w-full bg-violet-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-violet-700 transition duration-300 shadow-lg">
                                    Entrar
                                </button>
                            </div>
                        </form>
                        <div className="my-6 flex items-center">
                            <div className="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                            <span className="flex-shrink mx-4 text-gray-500 dark:text-gray-400 text-sm">OU</span>
                            <div className="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                        </div>
                        <button onClick={() => alert('Funcionalidade de login com Google a ser implementada.')} className="w-full flex items-center justify-center bg-white dark:bg-gray-700 text-gray-700 dark:text-white font-semibold py-3 px-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition duration-300 border border-gray-300 dark:border-gray-600 shadow-sm">
                            <svg className="w-5 h-5 mr-2" viewBox="0 0 48 48">
                                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path>
                            </svg>
                            Entrar com Google
                        </button>
                    </div>
                </div>
            );
        }

        const DashboardPage = ({ currentUser, setView, setEventId, mockEvents }) => (
            <div>
                <Header title="Início" />
                <main className="p-4 pb-20 max-w-4xl mx-auto">
                    <div className="bg-white dark:bg-gray-800 rounded-lg p-4 mb-6 shadow">
                        <h2 className="text-xl font-bold text-gray-800 dark:text-gray-200">Olá, {currentUser.name}!</h2>
                        <p className="text-gray-600 dark:text-gray-400">O que você gostaria de fazer hoje?</p>
                    </div>

                    {currentUser.id === 'admin' && (
                        <div className="mb-6">
                            <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-3">Gerenciamento</h3>
                            <div className="grid grid-cols-3 gap-2">
                                <button 
                                    onClick={() => setView('addEvent')} 
                                    className="bg-violet-600 text-white rounded-lg p-2 shadow-lg hover:bg-violet-700 transition flex flex-col items-center justify-center text-center h-24"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span className="font-semibold text-xs">Incluir Agendamento</span>
                                </button>
                                <button 
                                    onClick={() => setView('editScales')} 
                                    className="bg-violet-600 text-white rounded-lg p-2 shadow-lg hover:bg-violet-700 transition flex flex-col items-center justify-center text-center h-24"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536l12.232-12.232z" />
                                    </svg>
                                    <span className="font-semibold text-xs">Editar Escalas</span>
                                </button>
                                <button 
                                    onClick={() => setView('generateRoteiro')} 
                                    className="bg-violet-600 text-white rounded-lg p-2 shadow-lg hover:bg-violet-700 transition flex flex-col items-center justify-center text-center h-24"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span className="font-semibold text-xs">Gerar Roteiro</span>
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="space-y-4">
                        <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-3">Próximos Eventos</h3>
                        {mockEvents.map(event => (
                            <EventCard key={event.id} event={event} onClick={() => { setEventId(event.id); setView('eventDetail'); }} />
                        ))}
                    </div>
                </main>
            </div>
        );
        
        const AddEventPage = ({ setView, setMockEvents, mockEvents, editingEventId, setEditingEventId }) => {
            const [date, setDate] = useState('');
            const [status, setStatus] = useState('Aberta');
            const [department, setDepartment] = useState('');
            const [eventType, setEventType] = useState('');
            const [responsible, setResponsible] = useState('');
            const [mainRole, setMainRole] = useState('');
            const [observations, setObservations] = useState('');
            const [attachment, setAttachment] = useState(null);
            const [showSuccess, setShowSuccess] = useState(false);
            
            // Novos estados para campos de música
            const [nomeCantor, setNomeCantor] = useState('');
            const [integrante1, setIntegrante1] = useState('');
            const [integrante2, setIntegrante2] = useState('');
            const [integrante3, setIntegrante3] = useState('');
            const [integrante4, setIntegrante4] = useState('');
            const [musica1, setMusica1] = useState('');
            const [musica2, setMusica2] = useState('');
            const [musica3, setMusica3] = useState('');
            const [musica4, setMusica4] = useState('');
            const [existingAttachmentName, setExistingAttachmentName] = useState('');

            const departmentOptions = ALL_DEPARTMENTS_NAMES;
            const eventTypeOptions = ['Culto', 'CULTO DE SÁBADO', 'Ensaio', 'Ação Social', 'Reunião', 'Vigília'];
            const statusOptions = ['Aberta', 'Fechada', 'Em Andamento', 'Planejada'];
            const roleOptions = ['Louvor', 'Palavra', 'Recepção', 'Mídia', 'Social'];

            const isEditing = !!editingEventId;

            useEffect(() => {
                if (!editingEventId) {
                    resetForm();
                    return;
                }

                const eventToEdit = mockEvents.find(e => e.id === editingEventId);
                if (eventToEdit) {
                    setDate(eventToEdit.date || '');
                    setStatus(eventToEdit.status || 'Aberta');
                    setDepartment(eventToEdit.department || '');
                    setEventType(eventToEdit.eventType || '');
                    setResponsible(eventToEdit.responsible || '');
                    setMainRole(eventToEdit.mainRole || '');
                    setObservations(eventToEdit.description || ''); // 'description' é usado para observações
                    setAttachment(null); // Resetar anexo por segurança
                    setExistingAttachmentName(eventToEdit.attachmentName || '');
                    if(document.getElementById('attachment')) document.getElementById('attachment').value = '';

                    if (eventToEdit.musicDetails) {
                        const {
                            nomeCantor = '', integrante1 = '', integrante2 = '', integrante3 = '', integrante4 = '',
                            musica1 = '', musica2 = '', musica3 = '', musica4 = ''
                        } = eventToEdit.musicDetails;
                        setNomeCantor(nomeCantor);
                        setIntegrante1(integrante1);
                        setIntegrante2(integrante2);
                        setIntegrante3(integrante3);
                        setIntegrante4(integrante4);
                        setMusica1(musica1);
                        setMusica2(musica2);
                        setMusica3(musica3);
                        setMusica4(musica4);
                    } else {
                        setNomeCantor(''); setIntegrante1(''); setIntegrante2('');
                        setIntegrante3(''); setIntegrante4(''); setMusica1('');
                        setMusica2(''); setMusica3(''); setMusica4('');
                    }
                }
            }, [editingEventId, mockEvents]);


            const resetForm = () => {
                setDate(''); setStatus('Aberta'); setDepartment('');
                setEventType(''); setResponsible(''); setMainRole('');
                setObservations(''); setAttachment(null);
                setExistingAttachmentName('');
                if(document.getElementById('attachment')) document.getElementById('attachment').value = '';

                // Resetar campos de música
                setNomeCantor(''); setIntegrante1(''); setIntegrante2('');
                setIntegrante3(''); setIntegrante4(''); setMusica1('');
                setMusica2(''); setMusica3(''); setMusica4('');
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!date || !department || !eventType || !responsible) {
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }
                
                const eventData = {
                    name: eventType, date,
                    description: observations, status, eventType, 
                    department, responsible, mainRole,
                    attachmentName: attachment ? attachment.name : existingAttachmentName,
                    musicDetails: department === 'MINISTERIO DA MUSICA' ? {
                        nomeCantor, integrante1, integrante2, integrante3, integrante4,
                        musica1, musica2, musica3, musica4
                    } : null
                };

                if (isEditing) {
                    setMockEvents(prevEvents => prevEvents.map(event => 
                        event.id === editingEventId ? { ...event, ...eventData } : event
                    ));
                    alert('Agendamento atualizado com sucesso!');
                    setEditingEventId(null);
                    setView('editScales');
                } else {
                    const newEvent = {
                        ...eventData,
                        id: 'evt' + new Date().getTime(),
                        time: 'A definir', 
                        location: 'A definir',
                        serviceType: 'N/A', 
                    };
                    setMockEvents(prevEvents => [ newEvent, ...prevEvents]);
                    setShowSuccess(true);
                }
            };

            const isMusica = department === 'MINISTERIO DA MUSICA';
            const isCultoSábado = eventType === 'CULTO DE SÁBADO';
            const optionalFieldsRequired = isMusica && isCultoSábado;
            
            const handleBack = () => {
                setEditingEventId(null); // Limpa o ID de edição ao voltar
                setView(isEditing ? 'editScales' : 'dashboard');
            };

            return (
                <div>
                    <Header title={isEditing ? "Editar Agendamento" : "Incluir Novo Agendamento"} onBack={handleBack} />
                    <SuccessModal 
                        isOpen={showSuccess}
                        title="Agendamento Incluído!"
                        message={`O evento "${eventType}" foi criado com sucesso.`}
                        onAddNew={() => { setShowSuccess(false); resetForm(); }}
                        onGoToDashboard={() => { setShowSuccess(false); setView('dashboard'); }}
                    />
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Data <span className="text-red-500">*</span></label>
                                        <input type="date" value={date} onChange={e => setDate(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required />
                                    </div>
                                    <div>
                                        <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Status da Escala <span className="text-red-500">*</span></label>
                                        <select value={status} onChange={e => setStatus(e.target.value)} className="border-gray-300 rounded-md shadow-sm w-full dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" required>
                                            {statusOptions.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Departamento <span className="text-red-500">*</span></label>
                                        <select value={department} onChange={e => setDepartment(e.target.value)} className="border-gray-300 rounded-md shadow-sm w-full dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" required>
                                            <option value="" disabled>Selecione...</option>
                                            {departmentOptions.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Tipo do Evento <span className="text-red-500">*</span></label>
                                        <select value={eventType} onChange={e => setEventType(e.target.value)} className="border-gray-300 rounded-md shadow-sm w-full dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" required>
                                            <option value="" disabled>Selecione...</option>
                                            {eventTypeOptions.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Nome do Responsável <span className="text-red-500">*</span></label>
                                    <input type="text" value={responsible} onChange={e => setResponsible(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required />
                                </div>
                                 <div>
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Função Principal</label>
                                    <select value={mainRole} onChange={e => setMainRole(e.target.value)} className="border-gray-300 rounded-md shadow-sm w-full dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600">
                                        <option value="">Nenhuma</option>
                                        {roleOptions.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                    </select>
                                </div>
                                
                                {/* Campos Condicionais para Ministério da Música */}
                                {isMusica && (
                                    <div className="space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6 mt-6">
                                        <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200">Detalhes do Louvor</h3>
                                        <div>
                                            <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Nome do Cantor <span className="text-red-500">*</span></label>
                                            <input type="text" value={nomeCantor} onChange={e => setNomeCantor(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required />
                                        </div>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Integrante Louvor 1 <span className="text-red-500">*</span></label>
                                                <input type="text" value={integrante1} onChange={e => setIntegrante1(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required />
                                            </div>
                                            <div>
                                                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Integrante Louvor 2 <span className="text-red-500">*</span></label>
                                                <input type="text" value={integrante2} onChange={e => setIntegrante2(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required />
                                            </div>
                                            <div>
                                                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                                    Integrante Louvor 3 {optionalFieldsRequired && <span className="text-red-500">*</span>}
                                                </label>
                                                <input type="text" value={integrante3} onChange={e => setIntegrante3(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required={optionalFieldsRequired} />
                                            </div>
                                            <div>
                                                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                                    Integrante Louvor 4 {optionalFieldsRequired && <span className="text-red-500">*</span>}
                                                </label>
                                                <input type="text" value={integrante4} onChange={e => setIntegrante4(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required={optionalFieldsRequired} />
                                            </div>
                                        </div>
                                        
                                        {isCultoSábado && (
                                            <h4 className="text-md font-semibold text-gray-500 dark:text-gray-400 pt-2">Músicas Escola Sabatina</h4>
                                        )}
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Música 1 <span className="text-red-500">*</span></label>
                                                <input type="text" value={musica1} onChange={e => setMusica1(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required />
                                            </div>
                                            <div>
                                                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Música 2 <span className="text-red-500">*</span></label>
                                                <input type="text" value={musica2} onChange={e => setMusica2(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required />
                                            </div>
                                        </div>
                                        
                                        {isCultoSábado && (
                                            <h4 className="text-md font-semibold text-gray-500 dark:text-gray-400 pt-2">Músicas Culto</h4>
                                        )}
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                                    Música 3 {optionalFieldsRequired && <span className="text-red-500">*</span>}
                                                </label>
                                                <input type="text" value={musica3} onChange={e => setMusica3(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required={optionalFieldsRequired} />
                                            </div>
                                            <div>
                                                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">
                                                    Música 4 {optionalFieldsRequired && <span className="text-red-500">*</span>}
                                                </label>
                                                <input type="text" value={musica4} onChange={e => setMusica4(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required={optionalFieldsRequired} />
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div>
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Observações</label>
                                    <textarea value={observations} onChange={e => setObservations(e.target.value)} rows="3" className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600"></textarea>
                                </div>
                                <div>
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Anexo</label>
                                    {isEditing && existingAttachmentName && (
                                        <div className="flex items-center justify-between bg-gray-100 dark:bg-gray-700 p-2 rounded-md mb-2 text-sm">
                                            <span className="text-gray-700 dark:text-gray-300 truncate mr-2">{existingAttachmentName}</span>
                                            <button 
                                                type="button" 
                                                onClick={() => setExistingAttachmentName('')} 
                                                className="text-red-500 hover:text-red-700 font-semibold"
                                                title="Remover anexo"
                                            >
                                                Remover
                                            </button>
                                        </div>
                                    )}
                                    <input 
                                        id="attachment" 
                                        type="file" 
                                        onChange={e => {
                                            const file = e.target.files[0];
                                            setAttachment(file);
                                            setExistingAttachmentName(file ? file.name : '');
                                        }} 
                                        className="text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 dark:file:bg-violet-900/50 file:text-violet-700 dark:file:text-violet-300 hover:file:bg-violet-100 dark:hover:file:bg-violet-900"
                                    />
                                </div>
                                <div className="pt-4">
                                    <button type="submit" className="w-full bg-violet-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-violet-700 transition duration-300 shadow-lg">
                                        {isEditing ? 'Salvar Alterações' : 'Incluir Agendamento'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </main>
                </div>
            );
        };

        const EditScalesPage = ({ setView, mockEvents, setMockEvents, setEditingEventId }) => {
            const initialFilters = {
                date: '', status: 'Todos', eventType: 'Todos', serviceType: 'Todos', department: 'Todos'
            };

            const [filters, setFilters] = useState(initialFilters);
            const [modalInfo, setModalInfo] = useState({ isOpen: false, type: null, event: null });

            const filterOptions = useMemo(() => {
                const departments = [...new Set(mockEvents.map(e => e.department))];
                const statuses = [...new Set(mockEvents.map(e => e.status))];
                const eventTypes = [...new Set(mockEvents.map(e => e.eventType))];
                const serviceTypes = [...new Set(mockEvents.map(e => e.serviceType))];
                return { departments, statuses, eventTypes, serviceTypes };
            }, [mockEvents]);


            const handleFilterChange = (e) => {
                const { name, value } = e.target;
                setFilters(prev => ({ ...prev, [name]: value }));
            };
            
            const handleClearFilters = () => {
                setFilters(initialFilters);
            };

            const filteredEvents = useMemo(() => {
                return mockEvents.filter(event => {
                    if (filters.date && event.date !== filters.date) return false;
                    if (filters.status !== 'Todos' && event.status !== filters.status) return false;
                    if (filters.eventType !== 'Todos' && event.eventType !== filters.eventType) return false;
                    if (filters.serviceType !== 'Todos' && event.serviceType !== filters.serviceType) return false;
                    if (filters.department !== 'Todos' && event.department !== filters.department) return false;
                    return true;
                });
            }, [filters, mockEvents]);
            
            const getStatusBadgeColor = (status) => {
                switch (status) {
                    case 'Aberta': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300';
                    case 'Fechada': return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300';
                    case 'Em Andamento': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300';
                    default: return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
                }
            };
            
            const handleConfirmAction = () => {
                if (modalInfo.type === 'delete') {
                    setMockEvents(prevEvents => prevEvents.filter(event => event.id !== modalInfo.event.id));
                } else if (modalInfo.type === 'edit') {
                    setEditingEventId(modalInfo.event.id);
                    setView('addEvent');
                }
                setModalInfo({ isOpen: false, type: null, event: null }); // Close modal
            };

            return (
                <div>
                    <Header title="Editar Agendamentos" onBack={() => setView('dashboard')} />
                    <ConfirmationModal 
                        modalInfo={modalInfo}
                        onConfirm={handleConfirmAction}
                        onCancel={() => setModalInfo({ isOpen: false, type: null, event: null })}
                    />
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="font-bold text-gray-800 dark:text-gray-200">Filtros</h3>
                                <button onClick={handleClearFilters} className="text-sm text-violet-600 dark:text-violet-400 hover:text-violet-800 dark:hover:text-violet-300 font-semibold">Limpar Filtros</button>
                            </div>
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                                <input type="date" name="date" value={filters.date} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-violet-300 focus:ring focus:ring-violet-200 focus:ring-opacity-50 dark:bg-gray-700 dark:text-gray-300"/>
                                <select name="status" value={filters.status} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-violet-300 focus:ring focus:ring-violet-200 focus:ring-opacity-50 dark:bg-gray-700 dark:text-gray-300">
                                    <option value="Todos">Status (Todos)</option>
                                    {filterOptions.statuses.map(s => <option key={s} value={s}>{s}</option>)}
                                </select>
                                <select name="eventType" value={filters.eventType} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-violet-300 focus:ring focus:ring-violet-200 focus:ring-opacity-50 dark:bg-gray-700 dark:text-gray-300">
                                    <option value="Todos">Tipo Evento (Todos)</option>
                                    {filterOptions.eventTypes.map(t => <option key={t} value={t}>{t}</option>)}
                                </select>
                                <select name="serviceType" value={filters.serviceType} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-violet-300 focus:ring focus:ring-violet-200 focus:ring-opacity-50 dark:bg-gray-700 dark:text-gray-300">
                                    <option value="Todos">Tipo Culto (Todos)</option>
                                    {filterOptions.serviceTypes.map(s => <option key={s} value={s}>{s}</option>)}
                                </select>
                                <select name="department" value={filters.department} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-violet-300 focus:ring focus:ring-violet-200 focus:ring-opacity-50 dark:bg-gray-700 dark:text-gray-300">
                                    <option value="Todos">Depto (Todos)</option>
                                    {filterOptions.departments.map(d => <option key={d} value={d}>{d}</option>)}
                                </select>
                            </div>
                        </div>
                        
                        <div className="mb-4 px-1">
                            <p className="text-sm text-gray-600 dark:text-gray-400"><strong className="text-gray-800 dark:text-gray-200">{filteredEvents.length}</strong> agendamentos encontrados.</p>
                        </div>

                        <div className="space-y-3">
                            {filteredEvents.map(event => (
                                <div key={event.id} className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 hover:shadow-lg transition">
                                    <div className="flex justify-between items-center">
                                        {/* Informações da Escala */}
                                        <div onClick={() => alert(`Visualizar detalhes de: ${event.name}`)} className="cursor-pointer flex-1 mr-4">
                                            <h4 className="font-bold text-gray-900 dark:text-gray-200">{event.name}</h4>
                                            <div className="flex items-center gap-3 mt-1 text-sm">
                                                 <p className="text-gray-500 dark:text-gray-400">{new Date(event.date + 'T00:00:00').toLocaleDateString('pt-BR')} - {event.department}</p>
                                                 <span className={`px-2 py-0.5 text-xs font-semibold rounded-full ${getStatusBadgeColor(event.status)}`}>
                                                    {event.status}
                                                </span>
                                            </div>
                                        </div>
                                        {/* Botões de Ação */}
                                        <div className="flex gap-2">
                                            <button
                                                onClick={(e) => { 
                                                    e.stopPropagation();
                                                    setModalInfo({
                                                        isOpen: true,
                                                        type: 'edit',
                                                        event: event,
                                                        title: 'Confirmar Edição',
                                                        message: `Você tem certeza que deseja editar o agendamento "${event.name}"?`,
                                                        confirmText: 'Editar',
                                                        confirmColor: 'bg-violet-600 hover:bg-violet-700'
                                                    });
                                                }}
                                                className="p-2 text-violet-600 dark:text-violet-400 hover:bg-violet-100 dark:hover:bg-gray-700 rounded-full transition"
                                                title="Editar"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                                    <path strokeLinecap="round" strokeLinejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536l12.232-12.232z" />
                                                </svg>
                                            </button>
                                            <button
                                                onClick={(e) => { 
                                                    e.stopPropagation(); 
                                                    setModalInfo({
                                                        isOpen: true,
                                                        type: 'delete',
                                                        event: event,
                                                        title: 'Confirmar Exclusão',
                                                        message: `Tem certeza que deseja excluir o agendamento "${event.name}"? Esta ação não pode ser desfeita.`,
                                                        confirmText: 'Excluir',
                                                        confirmColor: 'bg-red-600 hover:bg-red-700'
                                                    });
                                                }}
                                                className="p-2 text-red-500 hover:bg-red-100 dark:hover:bg-gray-700 rounded-full transition"
                                                title="Excluir"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                                    <path strokeLinecap="round" strokeLinejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                             {filteredEvents.length === 0 && (
                                <p className="text-center text-gray-500 dark:text-gray-400 mt-6">Nenhum agendamento encontrado com os filtros selecionados.</p>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const GenerateRoteiroPage = ({ setView, mockEvents, mockDepartments }) => {
            const [selectedDate, setSelectedDate] = useState('2025-10-26');
            const [notificationModal, setNotificationModal] = useState({ isOpen: false, departmentName: '' });
            const [isLoading, setIsLoading] = useState(false);
            const [showSuccessToast, setShowSuccessToast] = useState(false);

            const eventsForDate = useMemo(() => {
                return mockEvents.filter(event => event.date === selectedDate);
            }, [selectedDate, mockEvents]);

            const departmentStatus = useMemo(() => {
                const scheduled = new Map(eventsForDate.map(e => [e.department, e]));
                const allDepts = Object.values(mockDepartments).map(d => d.DE_NOME_DEPARTAMENTO);
                return allDepts.map(deptName => ({
                    name: deptName,
                    isScheduled: scheduled.has(deptName),
                    event: scheduled.get(deptName),
                }));
            }, [eventsForDate, mockDepartments]);

            const handleNotifyClick = (departmentName) => {
                setNotificationModal({ isOpen: true, departmentName: departmentName });
            };
            
            const handleSendNotification = (method) => {
                const departmentName = notificationModal.departmentName;
                const departmentInfo = Object.values(mockDepartments).find(d => d.DE_NOME_DEPARTAMENTO === departmentName);
                
                setNotificationModal({ isOpen: false, departmentName: '' });

                if (method === 'WhatsApp') {
                    if (!departmentInfo || !departmentInfo.DE_CONTATO) {
                        alert(`Erro: Número de WhatsApp para "${departmentName}" não encontrado.`);
                        return;
                    }
                    
                    setIsLoading(true);
                    
                    setTimeout(() => {
                        console.log(`Simulando envio de WhatsApp para ${departmentInfo.DE_NOME_DEPARTAMENTO} no número ${departmentInfo.DE_CONTATO}`);
                        setIsLoading(false);
                        setShowSuccessToast(true);
                        
                        setTimeout(() => {
                            setShowSuccessToast(false);
                        }, 3000);

                    }, 2000); 

                } else if (method === 'E-mail') {
                    if (!departmentInfo || !departmentInfo.DE_EMAIL) {
                        alert(`Erro: E-mail para "${departmentName}" não encontrado.`);
                        return;
                    }
                    
                    setIsLoading(true);
                    
                    setTimeout(() => {
                        console.log(`Simulando envio de E-mail para ${departmentInfo.DE_NOME_DEPARTAMENTO} no endereço ${departmentInfo.DE_EMAIL}`);
                        setIsLoading(false);
                        setShowSuccessToast(true);
                        
                        setTimeout(() => {
                            setShowSuccessToast(false);
                        }, 3000);

                    }, 2000);
                }
            };

            const handleDownload = (format) => {
                alert(`Funcionalidade de "Gerar ${format.toUpperCase()}" a ser implementada. Seria gerado um arquivo com as escalas do dia ${new Date(selectedDate + 'T00:00:00').toLocaleDateString('pt-BR')}.`);
            };
            
            return (
                <div>
                    <Header title="Gerar Roteiro" onBack={() => setView('dashboard')} />
                    <LoadingModal isOpen={isLoading} message="Enviando mensagem..." />
                    <InfoToast isVisible={showSuccessToast} message="Mensagem enviada com Sucesso!" />
                    <NotificationChoiceModal
                        isOpen={notificationModal.isOpen}
                        departmentName={notificationModal.departmentName}
                        onSendEmail={() => handleSendNotification('E-mail')}
                        onSendWhatsApp={() => handleSendNotification('WhatsApp')}
                        onClose={() => setNotificationModal({ isOpen: false, departmentName: '' })}
                    />
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                            <label htmlFor="roteiro-date" className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Selecione a data para gerar o roteiro:</label>
                            <input 
                                type="date" 
                                id="roteiro-date"
                                value={selectedDate} 
                                onChange={e => setSelectedDate(e.target.value)} 
                                className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" 
                            />
                        </div>

                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                            <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4">Resumo dos Departamentos</h3>
                            <div className="space-y-3">
                                {departmentStatus.map(dept => (
                                    <div key={dept.name} className={`p-4 rounded-lg flex items-center justify-between transition-all duration-300 ${dept.isScheduled ? 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800' : 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800'} border`}>
                                        <div className="flex-1">
                                            <p className="font-semibold text-gray-800 dark:text-gray-200">{dept.name}</p>
                                            {dept.isScheduled ? (
                                                <>
                                                    <p className="text-sm text-green-700 dark:text-green-400 font-semibold">Agendamento Recebido</p>
                                                    <div className="mt-3 pt-3 border-t border-green-200 dark:border-green-800 text-sm text-gray-700 dark:text-gray-300 space-y-2">
                                                        <p><strong className="font-semibold text-gray-600 dark:text-gray-400">Evento:</strong> {dept.event.eventType}</p>
                                                        <p><strong className="font-semibold text-gray-600 dark:text-gray-400">Responsável:</strong> {dept.event.responsible}</p>
                                                        {dept.event.description && <p><strong className="font-semibold text-gray-600 dark:text-gray-400">Observações:</strong> {dept.event.description}</p>}
                                                        {dept.event.attachmentName && <p><strong className="font-semibold text-gray-600 dark:text-gray-400">Anexo:</strong> {dept.event.attachmentName}</p>}

                                                        {dept.event.department === 'MINISTERIO DA MUSICA' && dept.event.musicDetails && (
                                                            <div className="mt-2 pt-2 border-t border-green-200 dark:border-green-800">
                                                                <p><strong className="font-semibold text-gray-600 dark:text-gray-400">Cantor:</strong> {dept.event.musicDetails.nomeCantor}</p>
                                                                <p><strong className="font-semibold text-gray-600 dark:text-gray-400">Integrantes:</strong> {[dept.event.musicDetails.integrante1, dept.event.musicDetails.integrante2, dept.event.musicDetails.integrante3, dept.event.musicDetails.integrante4].filter(Boolean).join(', ')}</p>
                                                                <p className="mt-1"><strong className="font-semibold text-gray-600 dark:text-gray-400">Músicas:</strong></p>
                                                                <ul className="list-disc list-inside ml-2 text-xs">
                                                                    {dept.event.musicDetails.musica1 && <li>{dept.event.musicDetails.musica1}</li>}
                                                                    {dept.event.musicDetails.musica2 && <li>{dept.event.musicDetails.musica2}</li>}
                                                                    {dept.event.musicDetails.musica3 && <li>{dept.event.musicDetails.musica3}</li>}
                                                                    {dept.event.musicDetails.musica4 && <li>{dept.event.musicDetails.musica4}</li>}
                                                                </ul>
                                                            </div>
                                                        )}
                                                    </div>
                                                </>
                                            ) : (
                                                <p className="text-sm text-red-700 dark:text-red-400">Agendamento pendente</p>
                                            )}
                                        </div>
                                        <div className="ml-4">
                                            {dept.isScheduled ? (
                                                <div className="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0">
                                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={3}><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" /></svg>
                                                </div>
                                            ) : (
                                                <button onClick={() => handleNotifyClick(dept.name)} className="bg-yellow-500 text-white text-xs font-bold py-1 px-3 rounded-full hover:bg-yellow-600 transition flex-shrink-0">
                                                    Notificar
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                             <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4">Download do Roteiro</h3>
                             <div className="flex flex-col sm:flex-row gap-3">
                                <button onClick={() => handleDownload('pdf')} className="flex-1 bg-red-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-red-700 transition shadow flex items-center justify-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                                    Gerar PDF
                                </button>
                                <button onClick={() => handleDownload('xls')} className="flex-1 bg-green-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-green-700 transition shadow flex items-center justify-center gap-2">
                                     <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                                    Gerar XLS
                                </button>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };


        const EventDetailPage = ({ currentUser, eventId, setView, assignments, setAssignments, mockEvents, mockScales }) => {
            const event = mockEvents.find(e => e.id === eventId);
            const eventScales = mockScales.filter(s => s.eventId === eventId);
            
            const [isGenerating, setIsGenerating] = useState(false);
            const [generatedContent, setGeneratedContent] = useState('');
            const [modalTitle, setModalTitle] = useState('');

            const callGeminiAPI = async (prompt) => {
                setIsGenerating(true);
                setGeneratedContent(''); // Limpa o conteúdo anterior

                const apiKey = ""; // Chave de API será fornecida pelo ambiente
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        setGeneratedContent(text.replace(/\*/g, '')); // Remove asteriscos de formatação
                    } else {
                        setGeneratedContent('Não foi possível gerar o conteúdo. Tente novamente.');
                    }

                } catch (error) {
                    console.error("Falha na chamada da API Gemini:", error);
                    setGeneratedContent('Ocorreu um erro ao contatar a IA. Verifique sua conexão e tente novamente.');
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleGenerateInspiration = () => {
                setModalTitle('Mensagem Inspiradora ✨');
                const prompt = `Gere uma curta mensagem devocional ou inspiradora (cerca de 3-4 frases), baseada na Bíblia, para um evento de igreja chamado "${event.name}" com a seguinte descrição: "${event.description}". Mantenha um tom encorajador, acolhedor e focado na comunidade.`;
                callGeminiAPI(prompt);
            };

            const handleGenerateReminder = () => {
                const eventDateFormatted = new Date(event.date + 'T00:00:00').toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
                setModalTitle('Lembrete para Voluntários ✨');
                const prompt = `Crie uma mensagem de lembrete curta e amigável, em português, para enviar via WhatsApp aos voluntários do evento "${event.name}", que acontecerá em ${eventDateFormatted} às ${event.time}. Agradeça pelo serviço e confirme a participação deles. A mensagem deve ser geral e encorajadora.`;
                callGeminiAPI(prompt);
            };

            const closeModal = () => {
                setModalTitle('');
                setGeneratedContent('');
            };

            const copyToClipboard = () => {
                const textArea = document.createElement('textarea');
                textArea.value = generatedContent;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('Texto copiado!');
                } catch (err) {
                    alert('Não foi possível copiar o texto.');
                }
                document.body.removeChild(textArea);
            };
            
            const handleSignUp = (scaleId) => {
                const currentSignups = assignments[scaleId] || [];
                const scale = mockScales.find(s => s.id === scaleId);
                
                if (currentSignups.includes(currentUser.id)) { alert('Você já está inscrito nesta escala.'); return; }
                if (currentSignups.length >= scale.slots) { alert('Esta escala já está cheia.'); return; }

                if (confirm(`Confirmar inscrição para "${scale.name}"?`)) {
                    const newAssignments = { ...assignments };
                    newAssignments[scaleId] = [...currentSignups, currentUser.id];
                    setAssignments(newAssignments);
                    alert('Inscrição realizada com sucesso!');
                }
            };
            
            if (!event) return <div className="p-4">Evento não encontrado.</div>;
            
            const eventDate = new Date(event.date + 'T00:00:00');

            return (
                <div>
                    <Header title={event.name} onBack={() => setView('dashboard')} />
                     {modalTitle && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md animate-fade-in-up">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200">{modalTitle}</h3>
                                    <button onClick={closeModal} className="text-gray-400 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white text-3xl font-light">&times;</button>
                                </div>
                                <div className="min-h-[150px] text-gray-700 dark:text-gray-300 whitespace-pre-wrap p-2 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    {isGenerating ? <div className="flex justify-center items-center h-full pt-10"><div className="loader"></div></div> : generatedContent}
                                </div>
                                {!isGenerating && generatedContent && (
                                    <div className="mt-6 flex justify-end gap-2">
                                        <button onClick={copyToClipboard} className="bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-500 transition">Copiar</button>
                                        <button onClick={closeModal} className="bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 transition">Fechar</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                            <div className="flex items-center text-gray-600 dark:text-gray-400 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clipRule="evenodd" /></svg>
                                <span>{eventDate.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} às {event.time}</span>
                            </div>
                            <div className="flex items-center text-gray-600 dark:text-gray-400 mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd" /></svg>
                                <span>{event.location}</span>
                            </div>
                            <p className="text-gray-700 dark:text-gray-300">{event.description}</p>
                        </div>
                        
                         <div className="mb-6 bg-violet-50 dark:bg-gray-800 border border-violet-200 dark:border-violet-900 rounded-lg p-4">
                            <h3 className="text-lg font-bold text-violet-800 dark:text-violet-300 mb-3">Ferramentas com IA</h3>
                            <div className="flex flex-col sm:flex-row gap-3">
                                <button onClick={handleGenerateInspiration} className="flex-1 bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 transition shadow flex items-center justify-center gap-2">
                                    ✨ Gerar Mensagem Inspiradora
                                </button>
                                <button onClick={handleGenerateReminder} className="flex-1 bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 transition shadow flex items-center justify-center gap-2">
                                    ✨ Criar Lembrete para Voluntários
                                </button>
                            </div>
                        </div>

                        <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4">Escalas Disponíveis</h3>

                        <div className="space-y-4">
                            {eventScales.map(scale => {
                                const signedUpUsers = assignments[scale.id] || [];
                                const availableSlots = scale.slots - signedUpUsers.length;
                                return (
                                    <div key={scale.id} className="bg-white dark:bg-gray-800 rounded-lg shadow p-4">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h4 className="font-bold text-gray-900 dark:text-gray-200">{scale.name}</h4>
                                                <p className="text-sm text-gray-500 dark:text-gray-400">{availableSlots} de {scale.slots} vagas disponíveis</p>
                                            </div>
                                            <button 
                                              onClick={() => handleSignUp(scale.id)}
                                              disabled={availableSlots <= 0}
                                              className="bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 transition disabled:bg-gray-300 disabled:cursor-not-allowed"
                                            > Inscrever-se </button>
                                        </div>
                                        {signedUpUsers.length > 0 && (
                                            <div className="mt-4 border-t pt-3 dark:border-gray-700">
                                                <h5 className="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">Participantes:</h5>
                                                <div className="flex flex-wrap gap-2">
                                                    {signedUpUsers.map(userId => (
                                                        <div key={userId} className="flex items-center bg-gray-100 dark:bg-gray-700 rounded-full py-1 px-3">
                                                            <img src={MOCK_USERS[userId]?.avatar} className="w-6 h-6 rounded-full mr-2" alt={MOCK_USERS[userId]?.name} />
                                                            <span className="text-sm text-gray-800 dark:text-gray-200">{MOCK_USERS[userId]?.name || 'Usuário'}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </main>
                </div>
            );
        };
        
        const CalendarPage = ({ setView, setEventId, mockEvents }) => {
            const [currentDate, setCurrentDate] = useState(new Date(2025, 9, 15)); // Outubro de 2025
            const [filters, setFilters] = useState({ department: 'Todos', eventType: 'Todos' });

            const handleAction = (action) => alert(`Funcionalidade de "${action}" a ser implementada.`);
            
            const handleFilterChange = (e) => {
                const { name, value } = e.target;
                setFilters(prev => ({ ...prev, [name]: value }));
            };

            const filterOptions = useMemo(() => {
                const departments = ['Todos', ...new Set(mockEvents.map(e => e.department))];
                const eventTypes = ['Todos', ...new Set(mockEvents.map(e => e.eventType))];
                return { departments, eventTypes };
            }, [mockEvents]);

            const filteredEvents = useMemo(() => {
                return mockEvents.filter(event => {
                    if (filters.department !== 'Todos' && event.department !== filters.department) return false;
                    if (filters.eventType !== 'Todos' && event.eventType !== filters.eventType) return false;
                    return true;
                });
            }, [filters, mockEvents]);

            const calendarGrid = useMemo(() => {
                const year = currentDate.getFullYear(); const month = currentDate.getMonth();
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const grid = []; let dayCounter = 1;
                for (let i = 0; i < 6; i++) {
                    const week = [];
                    for (let j = 0; j < 7; j++) {
                        if ((i === 0 && j < firstDayOfMonth) || dayCounter > daysInMonth) {
                            week.push({ day: null, dayOfWeek: j });
                        } else {
                            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(dayCounter).padStart(2, '0')}`;
                            const eventsOnDay = filteredEvents.filter(e => e.date === dateStr);
                            week.push({ day: dayCounter, events: eventsOnDay, dayOfWeek: j });
                            dayCounter++;
                        }
                    }
                    grid.push(week);
                    if (dayCounter > daysInMonth) break;
                }
                return grid;
            }, [currentDate, filteredEvents]);

            const changeMonth = (offset) => setCurrentDate(prev => new Date(prev.getFullYear(), prev.getMonth() + offset, 1));
            
            return (
                <div>
                    <Header title="Calendário" />
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-4">
                            <div className="flex justify-between items-center mb-4">
                                <button onClick={() => changeMonth(-1)} className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300">&lt;</button>
                                <h2 className="text-lg font-bold text-gray-800 dark:text-gray-200 capitalize">{currentDate.toLocaleString('pt-BR', { month: 'long', year: 'numeric' })}</h2>
                                <button onClick={() => changeMonth(1)} className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300">&gt;</button>
                            </div>

                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4 text-sm">
                                <select name="department" value={filters.department} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-violet-300 focus:ring focus:ring-violet-200 focus:ring-opacity-50 dark:bg-gray-700 dark:text-gray-300">
                                    {filterOptions.departments.map(d => <option key={d} value={d}>{d === 'Todos' ? 'Departamento (Todos)' : d}</option>)}
                                </select>
                                <select name="eventType" value={filters.eventType} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-violet-300 focus:ring focus:ring-violet-200 focus:ring-opacity-50 dark:bg-gray-700 dark:text-gray-300">
                                    {filterOptions.eventTypes.map(t => <option key={t} value={t}>{t === 'Todos' ? 'Tipo de Evento (Todos)' : t}</option>)}
                                </select>
                            </div>

                            <div className="mb-4">
                                <button onClick={() => handleAction('Sincronizar com Google')} className="w-full bg-blue-500 text-white text-sm font-semibold py-2 px-3 rounded-lg hover:bg-blue-600 transition">
                                    Sincronizar com Google Calendar
                                </button>
                            </div>

                            <div className="grid grid-cols-7 gap-1 text-center text-sm text-gray-500 dark:text-gray-400">
                                {['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'].map(day => <div key={day} className="font-semibold">{day}</div>)}
                                {calendarGrid.flat().map((cell, index) => (
                                    <div key={index} className={`h-20 border border-transparent rounded-md p-1 transition-colors duration-200 ${cell.day ? 'hover:bg-gray-100 dark:hover:bg-gray-700' : 'bg-gray-50 dark:bg-gray-800/50'} ${[0, 3, 6].includes(cell.dayOfWeek) && cell.day ? 'bg-violet-50 dark:bg-violet-900/30' : ''}`}>
                                        {cell.day && <span className="font-medium text-gray-700 dark:text-gray-300">{cell.day}</span>}
                                        {cell.events && cell.events.map(event => (
                                            <div key={event.id} onClick={() => { setEventId(event.id); setView('eventDetail'); }} className="bg-violet-200 text-violet-900 dark:bg-violet-800 dark:text-violet-200 text-xs rounded p-1 mt-1 truncate cursor-pointer hover:bg-violet-300 dark:hover:bg-violet-700">
                                                {event.name}
                                            </div>
                                        ))}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };
        
        const ProfilePage = ({ currentUser, onLogout, onUpdateUser, setView }) => {
            const fileInputRef = useRef(null);

            const handlePhotoClick = () => {
                fileInputRef.current.click();
            };

            const handlePhotoChange = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const newAvatarUrl = URL.createObjectURL(file);
                    // Em um aplicativo real, você faria o upload deste arquivo para um servidor
                    // e obteria uma URL permanente. Para este protótipo, usamos uma URL de blob local.
                    onUpdateUser({ ...currentUser, avatar: newAvatarUrl });
                }
            };

            return (
                <div>
                    <Header title="Meu Perfil" />
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center">
                            <div className="relative w-24 h-24 mx-auto mb-4 group cursor-pointer" onClick={handlePhotoClick}>
                                <img src={currentUser.avatar} className="w-24 h-24 rounded-full mx-auto object-cover" alt="Avatar"/>
                                <div 
                                    className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 flex flex-col items-center justify-center rounded-full transition-opacity duration-300 opacity-0 group-hover:opacity-100"
                                    aria-label="Alterar foto de perfil"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-white mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    <span className="text-white text-xs font-bold">Alterar</span>
                                </div>
                                <input 
                                    type="file" 
                                    ref={fileInputRef} 
                                    onChange={handlePhotoChange}
                                    className="hidden" 
                                    accept="image/*"
                                />
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800 dark:text-gray-200">{currentUser.name}</h2>
                            <p className="text-gray-500 dark:text-gray-400">{currentUser.email}</p>
                            
                            <div className="mt-6 space-y-2">
                               <button onClick={() => setView('myScales')} className="w-full text-left bg-gray-50 dark:bg-gray-700 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 transition">Minhas Escalas</button>
                               <button onClick={() => setView('departmentData')} className="w-full text-left bg-gray-50 dark:bg-gray-700 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 transition">Dados Gerais do Depto.</button>
                               <button onClick={() => setView('settings')} className="w-full text-left bg-gray-50 dark:bg-gray-700 p-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 transition">Configurações</button>
                            </div>

                            <button onClick={onLogout} className="mt-8 w-full bg-red-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-600 transition">
                                Sair
                            </button>
                        </div>
                    </main>
                </div>
            );
        };

        const MyScalesPage = ({ currentUser, mockEvents, setView }) => {
            const initialFilters = { date: '', eventType: 'Todos', status: 'Todos', department: 'Todos', month: 'Todos' };
            const [filters, setFilters] = useState(initialFilters);
            
            const getStatusBadgeColor = (status) => {
                switch (status) {
                    case 'Aberta': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300';
                    case 'Fechada': return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300';
                    case 'Em Andamento': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300';
                    default: return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
                }
            };
            
            const handleFilterChange = (e) => {
                const { name, value } = e.target;
                setFilters(prev => ({ ...prev, [name]: value }));
            };
            
             const handleClearFilters = () => {
                setFilters(initialFilters);
            };

            const filteredEvents = useMemo(() => {
                // Para o admin, mostramos todas. Para outros usuários, filtramos pelo nome.
                const userEvents = currentUser.id === 'admin' 
                    ? mockEvents 
                    : mockEvents.filter(event => event.responsible === currentUser.name);

                return userEvents.filter(event => {
                    if (filters.date && event.date !== filters.date) return false;
                    if (filters.eventType !== 'Todos' && event.eventType !== filters.eventType) return false;
                    if (filters.status !== 'Todos' && event.status !== filters.status) return false;
                    if (filters.department !== 'Todos' && event.department !== filters.department) return false;
                    if (filters.month !== 'Todos') {
                        const eventMonth = new Date(event.date + 'T00:00:00').getMonth() + 1;
                        if (eventMonth !== parseInt(filters.month)) return false;
                    }
                    return true;
                });
            }, [filters, mockEvents, currentUser]);
            
            const filterOptions = useMemo(() => {
                const events = currentUser.id === 'admin' ? mockEvents : mockEvents.filter(e => e.responsible === currentUser.name);
                const eventTypes = ['Todos', ...new Set(events.map(e => e.eventType))];
                const statuses = ['Todos', ...new Set(events.map(e => e.status))];
                const departments = ['Todos', ...new Set(events.map(e => e.department))];
                return { eventTypes, statuses, departments };
            }, [mockEvents, currentUser]);
            
            const monthOptions = [
                { value: 'Todos', label: 'Mês (Todos)' }, { value: '1', label: 'Janeiro' }, { value: '2', label: 'Fevereiro' },
                { value: '3', label: 'Março' }, { value: '4', label: 'Abril' }, { value: '5', label: 'Maio' },
                { value: '6', label: 'Junho' }, { value: '7', label: 'Julho' }, { value: '8', label: 'Agosto' },
                { value: '9', label: 'Setembro' }, { value: '10', label: 'Outubro' }, { value: '11', label: 'Novembro' },
                { value: '12', label: 'Dezembro' }
            ];

            return (
                <div>
                    <Header title="Minhas Escalas" onBack={() => setView('profile')} />
                     <main className="p-4 pb-20 max-w-4xl mx-auto">
                         <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="font-bold text-gray-800 dark:text-gray-200">Filtros</h3>
                                <button onClick={handleClearFilters} className="text-sm text-violet-600 dark:text-violet-400 hover:text-violet-800 dark:hover:text-violet-300 font-semibold">Limpar Filtros</button>
                            </div>
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                                <input type="date" name="date" value={filters.date} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-violet-300 focus:ring focus:ring-violet-200 focus:ring-opacity-50 dark:bg-gray-700 dark:text-gray-300"/>
                                <select name="eventType" value={filters.eventType} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-gray-300">
                                    {filterOptions.eventTypes.map((opt, index) => <option key={`eventType-${opt}-${index}`} value={opt}>{opt === 'Todos' ? 'Tipo de Evento (Todos)' : opt}</option>)}
                                </select>
                                <select name="status" value={filters.status} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-gray-300">
                                     {filterOptions.statuses.map((opt, index) => <option key={`status-${opt}-${index}`} value={opt}>{opt === 'Todos' ? 'Status (Todos)' : opt}</option>)}
                                </select>
                                <select name="department" value={filters.department} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-gray-300">
                                     {filterOptions.departments.map((opt, index) => <option key={`department-${opt}-${index}`} value={opt}>{opt === 'Todos' ? 'Departamento (Todos)' : opt}</option>)}
                                </select>
                                <select name="month" value={filters.month} onChange={handleFilterChange} className="border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-gray-300">
                                     {monthOptions.map(opt => <option key={opt.value} value={opt.value}>{opt.label}</option>)}
                                </select>
                            </div>
                        </div>

                        <div className="space-y-4">
                            {filteredEvents.length > 0 ? filteredEvents.map(event => (
                                <div key={event.id} className="bg-white dark:bg-gray-800 rounded-lg shadow p-4">
                                     <h4 className="font-bold text-gray-900 dark:text-gray-200">{event.name}</h4>
                                     <div className="flex items-center gap-3 mt-1 text-sm text-gray-500 dark:text-gray-400">
                                         <span>{new Date(event.date + 'T00:00:00').toLocaleDateString('pt-BR')}</span>
                                         <span>-</span>
                                         <span>{event.department}</span>
                                         <span className={`px-2 py-0.5 text-xs font-semibold rounded-full ${getStatusBadgeColor(event.status)}`}>
                                            {event.status}
                                        </span>
                                     </div>
                                     {event.description && <p className="text-sm text-gray-600 dark:text-gray-300 mt-2">{event.description}</p>}
                                </div>
                            )) : (
                                <p className="text-center text-gray-500 dark:text-gray-400 mt-8">Nenhuma escala encontrada com os filtros selecionados.</p>
                            )}
                        </div>
                     </main>
                </div>
            );
        };
        
        const DepartmentDataPage = ({ setView }) => {
            const [department, setDepartment] = useState('');
            const [leader, setLeader] = useState('');
            const [description, setDescription] = useState('');
            const [goals, setGoals] = useState('');
            const [importantEvents, setImportantEvents] = useState([{ date: '', observation: '' }]);
            const [apvEvents, setApvEvents] = useState([{ date: '', observation: '' }]);
            const [attachments, setAttachments] = useState([]);

            const handleEventChange = (index, field, value, type) => {
                const list = type === 'important' ? [...importantEvents] : [...apvEvents];
                list[index][field] = value;
                if (type === 'important') {
                    setImportantEvents(list);
                } else {
                    setApvEvents(list);
                }
            };

            const addEventField = (type) => {
                if (type === 'important') {
                    setImportantEvents([...importantEvents, { date: '', observation: '' }]);
                } else {
                    setApvEvents([...apvEvents, { date: '', observation: '' }]);
                }
            };

            const removeEventField = (index, type) => {
                const list = type === 'important' ? [...importantEvents] : [...apvEvents];
                if (list.length > 1) {
                    list.splice(index, 1);
                    if (type === 'important') {
                        setImportantEvents(list);
                    } else {
                        setApvEvents(list);
                    }
                }
            };

            const handleAttachmentChange = (e) => {
                setAttachments(prev => [...prev, ...Array.from(e.target.files)]);
            };
            
            const removeAttachment = (index) => {
                setAttachments(prev => prev.filter((_, i) => i !== index));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                // Simulação de salvamento
                alert('Dados do departamento salvos com sucesso! (Simulação)');
                console.log({
                    department, leader, description, goals, importantEvents, apvEvents, attachments
                });
                setView('profile');
            };

            return (
                <div>
                    <Header title="Dados Gerais do Depto." onBack={() => setView('profile')} />
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div>
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Nome do Departamento <span className="text-red-500">*</span></label>
                                    <select value={department} onChange={e => setDepartment(e.target.value)} className="border-gray-300 rounded-md shadow-sm w-full dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" required>
                                        <option value="" disabled>Selecione um departamento</option>
                                        {ALL_DEPARTMENTS_NAMES.map(dept => <option key={dept} value={dept}>{dept}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Líder do Departamento <span className="text-red-500">*</span></label>
                                    <input type="text" value={leader} onChange={e => setLeader(e.target.value)} className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required />
                                </div>
                                <div>
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Descrição do Departamento <span className="text-red-500">*</span></label>
                                    <textarea value={description} onChange={e => setDescription(e.target.value)} rows="4" className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required></textarea>
                                </div>
                                <div>
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Objetivos do Ano <span className="text-red-500">*</span></label>
                                    <textarea value={goals} onChange={e => setGoals(e.target.value)} rows="4" className="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600" required></textarea>
                                </div>
                                
                                <div className="border-t dark:border-gray-700 pt-6">
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Eventos Importantes</label>
                                    {importantEvents.map((event, index) => (
                                        <div key={index} className="flex items-center gap-2 mb-2">
                                            <input type="date" value={event.date} onChange={e => handleEventChange(index, 'date', e.target.value, 'important')} className="border-gray-300 rounded-md shadow-sm w-1/3 py-2 px-3 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" />
                                            <input type="text" placeholder="Observação do evento" value={event.observation} onChange={e => handleEventChange(index, 'observation', e.target.value, 'important')} className="shadow appearance-none border rounded-md w-2/3 py-2 px-3 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" />
                                            {importantEvents.length > 1 && <button type="button" onClick={() => removeEventField(index, 'important')} className="text-red-500 hover:text-red-700 p-2 rounded-full">
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clipRule="evenodd" /></svg>
                                            </button>}
                                        </div>
                                    ))}
                                    <button type="button" onClick={() => addEventField('important')} className="text-sm text-violet-600 dark:text-violet-400 font-semibold hover:text-violet-800 dark:hover:text-violet-300">+ Adicionar Evento</button>
                                </div>

                                <div className="border-t dark:border-gray-700 pt-6">
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Eventos da APV</label>
                                     {apvEvents.map((event, index) => (
                                        <div key={index} className="flex items-center gap-2 mb-2">
                                            <input type="date" value={event.date} onChange={e => handleEventChange(index, 'date', e.target.value, 'apv')} className="border-gray-300 rounded-md shadow-sm w-1/3 py-2 px-3 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" />
                                            <input type="text" placeholder="Observação do evento" value={event.observation} onChange={e => handleEventChange(index, 'observation', e.target.value, 'apv')} className="shadow appearance-none border rounded-md w-2/3 py-2 px-3 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600" />
                                            {apvEvents.length > 1 && <button type="button" onClick={() => removeEventField(index, 'apv')} className="text-red-500 hover:text-red-700 p-2 rounded-full">
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clipRule="evenodd" /></svg>
                                            </button>}
                                        </div>
                                    ))}
                                    <button type="button" onClick={() => addEventField('apv')} className="text-sm text-violet-600 dark:text-violet-400 font-semibold hover:text-violet-800 dark:hover:text-violet-300">+ Adicionar Evento</button>
                                </div>

                                <div className="border-t dark:border-gray-700 pt-6">
                                    <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Anexos Gerais</label>
                                    <input type="file" multiple onChange={handleAttachmentChange} className="text-sm text-gray-500 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 dark:file:bg-violet-900/50 file:text-violet-700 dark:file:text-violet-300 hover:file:bg-violet-100 dark:hover:file:bg-violet-900 mb-2" />
                                    <div className="space-y-2 mt-2">
                                        {attachments.map((file, index) => (
                                            <div key={index} className="flex items-center justify-between bg-gray-100 dark:bg-gray-700 p-2 rounded-md text-sm">
                                                <span className="text-gray-700 dark:text-gray-300 truncate mr-2">{file.name}</span>
                                                <button type="button" onClick={() => removeAttachment(index)} className="text-red-500 hover:text-red-700 font-semibold">Remover</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="pt-4">
                                    <button type="submit" className="w-full bg-violet-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-violet-700 transition duration-300 shadow-lg">
                                        Salvar Dados
                                    </button>
                                </div>
                            </form>
                        </div>
                    </main>
                </div>
            );
        };
        
        const SettingsPage = ({ currentUser, setView, setManagingTable, theme, setTheme, onUpdatePassword }) => {
            const [activeTab, setActiveTab] = useState('aparencia');
            const [novaSenha, setNovaSenha] = useState('');
            const [confirmarSenha, setConfirmarSenha] = useState('');
            const [showCurrentPassword, setShowCurrentPassword] = useState(false);
            const [showNewPassword, setShowNewPassword] = useState(false);
            const [showConfirmPassword, setShowConfirmPassword] = useState(false);
            const [modalInfo, setModalInfo] = useState({ isOpen: false });

            const handleOpenTable = (tableName) => {
                setManagingTable(tableName);
                setView('manageTable');
            };

            const settingsOptions = [
                { id: 'seguranca', label: 'Segurança' },
                { id: 'notificacoes', label: 'Notificações' },
                { id: 'aparencia', label: 'Aparência' },
                { id: 'informacoes', label: 'Informações Gerais' },
                { id: 'integracoes', label: 'Integrações' },
            ];
            
            const handleThemeToggle = () => {
                setTheme(prevTheme => prevTheme === 'light' ? 'dark' : 'light');
            };

            const handlePasswordSubmit = (e) => {
                e.preventDefault();
                if (novaSenha !== confirmarSenha) {
                    alert("As novas senhas não correspondem.");
                    return;
                }
                if (novaSenha.length < 3) {
                    alert("A nova senha deve ter pelo menos 3 caracteres.");
                    return;
                }
                
                setModalInfo({
                    isOpen: true,
                    title: 'Confirmar Alteração de Senha',
                    message: 'Você tem certeza que deseja alterar sua senha? Esta ação é permanente.',
                    confirmText: 'Alterar Senha',
                    confirmColor: 'bg-violet-600 hover:bg-violet-700'
                });
            };
            
            const confirmPasswordChange = () => {
                onUpdatePassword(novaSenha);
                alert("Senha alterada com sucesso!");
                setNovaSenha('');
                setConfirmarSenha('');
                setModalInfo({ isOpen: false });
            };

            const renderContent = () => {
                switch (activeTab) {
                    case 'seguranca':
                        return (
                            <div>
                                <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-4">Segurança</h3>
                                <form onSubmit={handlePasswordSubmit} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-bold mb-1 dark:text-gray-300">Senha Atual</label>
                                        <div className="relative">
                                            <input 
                                              type={showCurrentPassword ? "text" : "password"} 
                                              value={currentUser.senha} 
                                              readOnly 
                                              className="w-full border-gray-300 rounded-md shadow-sm bg-gray-100 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300"
                                            />
                                            <button type="button" onClick={() => setShowCurrentPassword(!showCurrentPassword)} className="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5">
                                                {showCurrentPassword ? <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l18 18" /></svg> : <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.522 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>}
                                            </button>
                                        </div>
                                    </div>
                                    <div className="relative">
                                        <label className="block text-sm font-bold mb-1 dark:text-gray-300">Nova Senha</label>
                                        <input type={showNewPassword ? "text" : "password"} value={novaSenha} onChange={(e) => setNovaSenha(e.target.value)} placeholder="Nova Senha" className="w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
                                         <button type="button" onClick={() => setShowNewPassword(!showNewPassword)} className="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5 pt-6">
                                            {showNewPassword ? <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l18 18" /></svg> : <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.522 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>}
                                        </button>
                                    </div>
                                    <div className="relative">
                                        <label className="block text-sm font-bold mb-1 dark:text-gray-300">Confirmar Nova Senha</label>
                                        <input type={showConfirmPassword ? "text" : "password"} value={confirmarSenha} onChange={(e) => setConfirmarSenha(e.target.value)} placeholder="Confirmar Nova Senha" className="w-full border-gray-300 rounded-md shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
                                         <button type="button" onClick={() => setShowConfirmPassword(!showConfirmPassword)} className="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5 pt-6">
                                            {showConfirmPassword ? <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l18 18" /></svg> : <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-gray-600 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.522 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>}
                                        </button>
                                    </div>
                                    <button type="submit" className="bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700">Salvar Nova Senha</button>
                                </form>
                                {currentUser.id === 'admin' && (
                                    <div className="mt-8 pt-6 border-t dark:border-gray-700">
                                         <h4 className="font-semibold mb-4 dark:text-gray-300">Gerenciamento de Usuários</h4>
                                         <p className="text-sm text-gray-600 dark:text-gray-400">Aqui o administrador poderá adicionar, editar e remover usuários do sistema.</p>
                                         {/* Placeholder para gerenciamento de usuários */}
                                    </div>
                                )}
                            </div>
                        );
                    case 'notificacoes':
                         return (
                            <div>
                                <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-4">Notificações</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                                        <label htmlFor="email-notifications" className="font-medium text-gray-700 dark:text-gray-300">Notificações por E-mail</label>
                                        <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                            <input type="checkbox" name="toggle" id="email-notifications" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                            <label htmlFor="email-notifications" className="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                        </div>
                                    </div>
                                     <div className="flex justify-between items-center bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                                        <label htmlFor="push-notifications" className="font-medium text-gray-700 dark:text-gray-300">Notificações Push</label>
                                         <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                            <input type="checkbox" name="toggle" id="push-notifications" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" defaultChecked/>
                                            <label htmlFor="push-notifications" className="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                        </div>
                                    </div>
                                </div>
                                <style>{`
                                    .toggle-checkbox:checked { right: 0; border-color: #6d28d9; }
                                    .toggle-checkbox:checked + .toggle-label { background-color: #6d28d9; }
                                `}</style>
                            </div>
                        );
                    case 'aparencia':
                         return (
                            <div>
                                <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-4">Aparência</h3>
                                 <div className="flex justify-between items-center bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                                    <label htmlFor="dark-mode" className="font-medium text-gray-700 dark:text-gray-300">Modo Escuro</label>
                                    <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                        <input type="checkbox" name="toggle" id="dark-mode" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" onChange={handleThemeToggle} checked={theme === 'dark'} />
                                        <label htmlFor="dark-mode" className="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer"></label>
                                    </div>
                                </div>
                                <style>{`
                                    .toggle-checkbox:checked { right: 0; border-color: #6d28d9; }
                                    .toggle-checkbox:checked + .toggle-label { background-color: #6d28d9; }
                                `}</style>
                            </div>
                        );
                    case 'informacoes':
                         return (
                            <div>
                                <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-4">Informações Gerais</h3>
                                <div className="text-gray-700 dark:text-gray-300">
                                    <p><strong>Versão do App:</strong> 1.0.0 (Protótipo)</p>
                                    <p><strong>Desenvolvido por:</strong> Seu Time de Desenvolvimento</p>
                                    <a href="#" className="text-violet-600 dark:text-violet-400 hover:underline mt-2 inline-block">Termos de Serviço</a><br/>
                                    <a href="#" className="text-violet-600 dark:text-violet-400 hover:underline">Política de Privacidade</a>
                                </div>
                            </div>
                        );
                    case 'integracoes':
                        return (
                             <div>
                                <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200 mb-4">Integrações</h3>
                                {currentUser.id === 'admin' ? (
                                    <div className="space-y-6">
                                        <div>
                                            <h4 className="font-semibold dark:text-gray-300">Atualização de Tabelas Mestre</h4>
                                            <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">Realize o deploy de atualizações para as tabelas de dados principais do sistema.</p>
                                            
                                            <div className="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg flex justify-between items-center mb-2">
                                                <div>
                                                    <p className="font-medium text-gray-800 dark:text-gray-200">Tabela de Eventos</p>
                                                    <p className="text-xs text-gray-500 dark:text-gray-400">Atualiza os tipos de eventos disponíveis.</p>
                                                </div>
                                                <button 
                                                    onClick={() => handleOpenTable('EVENTOS')} 
                                                    className="bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 w-32 text-center"
                                                >
                                                    Abrir Tabela
                                                </button>
                                            </div>

                                            <div className="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg flex justify-between items-center mb-2">
                                                 <div>
                                                    <p className="font-medium text-gray-800 dark:text-gray-200">Tabela de Departamentos</p>
                                                    <p className="text-xs text-gray-500 dark:text-gray-400">Atualiza a lista de departamentos e contatos.</p>
                                                </div>
                                                <button 
                                                    onClick={() => handleOpenTable('DEPARTAMENTOS')}
                                                    className="bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 w-32 text-center"
                                                >
                                                    Abrir Tabela
                                                </button>
                                            </div>

                                             <div className="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg flex justify-between items-center">
                                                <div>
                                                    <p className="font-medium text-gray-800 dark:text-gray-200">Tabela de Acesso</p>
                                                    <p className="text-xs text-gray-500 dark:text-gray-400">Atualiza perfis e permissões de usuários.</p>
                                                </div>
                                                <button 
                                                    onClick={() => handleOpenTable('ACESSO')}
                                                    className="bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg text-sm hover:bg-violet-700 w-32 text-center"
                                                >
                                                   Abrir Tabela
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                     <div>
                                        <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">Conecte sua conta com outros serviços para facilitar seu dia a dia.</p>
                                        <button className="w-full bg-blue-500 text-white font-semibold py-2 px-3 rounded-lg hover:bg-blue-600 transition">
                                            Sincronizar com Google Calendar
                                        </button>
                                    </div>
                                )}
                            </div>
                        );
                    default: return null;
                }
            };
            
            return (
                <div>
                    <Header title="Configurações" onBack={() => setView('profile')} />
                     <ConfirmationModal modalInfo={modalInfo} onConfirm={confirmPasswordChange} onCancel={() => setModalInfo({isOpen: false})} />
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md md:flex">
                            <aside className="md:w-1/4 p-4 border-b md:border-b-0 md:border-r dark:border-gray-700">
                                <nav className="space-y-1">
                                    {settingsOptions.map(opt => (
                                        <button 
                                            key={opt.id}
                                            onClick={() => setActiveTab(opt.id)}
                                            className={`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition ${activeTab === opt.id ? 'bg-violet-100 dark:bg-violet-900/50 text-violet-700 dark:text-violet-300' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-200'}`}
                                        >
                                            {opt.label}
                                        </button>
                                    ))}
                                </nav>
                            </aside>
                            <div className="p-6 flex-1">
                                {renderContent()}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };
        
       const ManageTablePage = ({ tableName, setView, mockEvents, currentUser, setMockEvents, mockDepartments, setMockDepartments, mockAccess, setMockAccess }) => {
            const [currentRecords, setCurrentRecords] = useState([]);
            const [newRecords, setNewRecords] = useState([]);
            const [newRecordInput, setNewRecordInput] = useState({});
            const [updateStatus, setUpdateStatus] = useState('idle'); // idle, loading, success, error
            const [logMessage, setLogMessage] = useState('');
            const [editingRecordId, setEditingRecordId] = useState(null);
            const [editedRecordData, setEditedRecordData] = useState(null);
            const [modalInfo, setModalInfo] = useState({ isOpen: false });

            useEffect(() => {
                setEditingRecordId(null);
                setEditedRecordData(null);
                setNewRecords([]);

                if (tableName === 'EVENTOS') {
                    const eventRecords = mockEvents.map(e => ({ RE_ID_EVENTOS: e.id, EV_NOME_EVENTO: e.name, EV_TIPO_EVENTO: e.eventType, ...e.logInfo }));
                    setCurrentRecords(eventRecords);
                    setNewRecordInput({ EV_NOME_EVENTO: '', EV_TIPO_EVENTO: '' });
                } else if (tableName === 'DEPARTAMENTOS') {
                    setCurrentRecords(Object.values(mockDepartments));
                    setNewRecordInput({ DE_NOME_DEPARTAMENTO: '', DE_LIDER_DEPTO: '', DE_ASSOCIADO_DEPTO: '', DE_CONTATO: '', DE_ANCIAO_LIDER: '', DE_EMAIL: '' });
                } else if (tableName === 'ACESSO') {
                    setCurrentRecords(Object.values(mockAccess));
                    setNewRecordInput({ AC_LOGIN: '', AC_SENHA: '', AC_DEPARTAMENTO: '', AC_RESP: '', AC_EMAIL: '', AC_APROVACAO: 'P', AC_NOTIFICACAO: '' });
                }
                else {
                    setCurrentRecords([]);
                    setNewRecordInput({});
                }
            }, [tableName, mockEvents, mockDepartments, mockAccess]);

            const handleInputChange = e => setNewRecordInput(prev => ({ ...prev, [e.target.name]: e.target.value }));

            const handleAddItem = (e) => {
                e.preventDefault();
                let requiredFields;
                if (tableName === 'DEPARTAMENTOS') {
                    requiredFields = ['DE_NOME_DEPARTAMENTO', 'DE_LIDER_DEPTO', 'DE_ASSOCIADO_DEPTO', 'DE_CONTATO', 'DE_ANCIAO_LIDER', 'DE_EMAIL'];
                } else if (tableName === 'ACESSO') {
                    requiredFields = ['AC_LOGIN', 'AC_SENHA', 'AC_DEPARTAMENTO', 'AC_RESP', 'AC_EMAIL', 'AC_APROVACAO'];
                } else { // EVENTOS
                    requiredFields = ['EV_NOME_EVENTO', 'EV_TIPO_EVENTO'];
                }
                
                if (requiredFields.some(field => !newRecordInput[field] || String(newRecordInput[field]).trim() === '')) {
                     alert('Todos os campos obrigatórios devem ser preenchidos.');
                     return;
                }
                
                setNewRecords(prev => [...prev, { tempId: `new-${Date.now()}`, ...newRecordInput }]);
                
                // Reset form
                if (tableName === 'DEPARTAMENTOS') setNewRecordInput({ DE_NOME_DEPARTAMENTO: '', DE_LIDER_DEPTO: '', DE_ASSOCIADO_DEPTO: '', DE_CONTATO: '', DE_ANCIAO_LIDER: '', DE_EMAIL: '' });
                else if (tableName === 'ACESSO') setNewRecordInput({ AC_LOGIN: '', AC_SENHA: '', AC_DEPARTAMENTO: '', AC_RESP: '', AC_EMAIL: '', AC_APROVACAO: 'P', AC_NOTIFICACAO: '' });
                else setNewRecordInput({ EV_NOME_EVENTO: '', EV_TIPO_EVENTO: '' });
            };
            
            const handleRemoveNewItem = (tempId) => setNewRecords(newRecords.filter(item => item.tempId !== tempId));

            const handleUpdate = () => {
                if (newRecords.length === 0) {
                    alert("Nenhum novo registro para adicionar.");
                    return;
                }
                setUpdateStatus('loading');
                
                setTimeout(() => {
                    if (Math.random() > 0.3) { // Success
                        setUpdateStatus('success');
                        const now = new Date().toLocaleString('pt-BR');
                        
                        if (tableName === 'DEPARTAMENTOS') {
                            const newDeptEntries = newRecords.map(rec => { const newId = `dept${Date.now() + Math.random()}`; return { ...rec, DE_ID_DEPTO: newId, logInfo: { RE_DATA_UPDATE: now, RE_DATA_MODIFICACAO: now, RE_USUARIO_LOGADO: currentUser.name } }; });
                            setMockDepartments(prev => { const newDepts = {...prev}; newDeptEntries.forEach(d => { newDepts[d.DE_ID_DEPTO] = d; }); return newDepts; });
                        } else if (tableName === 'EVENTOS') {
                             const newMockEvents = newRecords.map(rec => {
                                const newId = `evt${Date.now() + Math.random()}`;
                                return { id: newId, name: rec.EV_NOME_EVENTO, eventType: rec.EV_TIPO_EVENTO, date: 'N/A', time: 'N/A', location: 'N/A', description: '', status: 'Planejada', logInfo: { RE_DATA_UPDATE: now, RE_DATA_MODIFICACAO: now, RE_USUARIO_LOGADO: currentUser.name }};
                             });
                             setMockEvents(prev => [...prev, ...newMockEvents]);
                        } else if (tableName === 'ACESSO') {
                            const newAccessEntries = newRecords.map(rec => { const newId = `acc${Date.now() + Math.random()}`; return { ...rec, AC_ID: newId, logInfo: { RE_DATA_UPDATE: now, RE_DATA_MODIFICACAO: now, RE_USUARIO_LOGADO: currentUser.name } }; });
                            setMockAccess(prev => { const newAccess = {...prev}; newAccessEntries.forEach(a => { newAccess[a.AC_ID] = a; }); return newAccess; });
                        }
                    } else { // Error
                        setUpdateStatus('error');
                        const now = new Date().toLocaleString('pt-BR');
                        setLogMessage(`[${now}] ERROR: 500\nFalha ao executar INSERT na tabela ${tableName}.\nUsuário: ${currentUser.name}\nVerifique a integridade dos dados e a conexão.`);
                    }
                }, 2000);
            };
            
            const resetAndUpdate = () => {
                setUpdateStatus('idle');
                setNewRecords([]);
            };

            const handleStartEdit = (record) => {
                const id = tableName === 'EVENTOS' ? record.RE_ID_EVENTOS : (tableName === 'DEPARTAMENTOS' ? record.DE_ID_DEPTO : record.AC_ID);
                setEditingRecordId(id);
                setEditedRecordData({ ...record });
            };

            const handleCancelEdit = () => {
                setEditingRecordId(null);
                setEditedRecordData(null);
            };

            const handleEditedInputChange = (e) => {
                const { name, value } = e.target;
                setEditedRecordData(prev => ({ ...prev, [name]: value }));
            };
            
            const handleConfirmAction = () => {
                const { type, record } = modalInfo;
                if (type === 'save') {
                    const now = new Date().toLocaleString('pt-BR');
                    const updatedLogInfo = { ...record.logInfo, RE_DATA_MODIFICACAO: now, RE_USUARIO_LOGADO: currentUser.name };
                    
                    if (tableName === 'DEPARTAMENTOS') {
                        const updatedRecord = { ...editedRecordData, logInfo: updatedLogInfo };
                        setMockDepartments(prev => ({...prev, [record.DE_ID_DEPTO]: updatedRecord }));
                    } else if (tableName === 'ACESSO') {
                        const updatedRecord = { ...editedRecordData, logInfo: updatedLogInfo };
                        setMockAccess(prev => ({...prev, [record.AC_ID]: updatedRecord }));
                    } else { // EVENTOS
                         const updatedRecord = { ...record, ...editedRecordData, RE_DATA_MODIFICACAO: now, RE_USUARIO_LOGADO: currentUser.name };
                         setMockEvents(mockEvents.map(e => e.id === record.RE_ID_EVENTOS ? { ...e, name: updatedRecord.EV_NOME_EVENTO, eventType: updatedRecord.EV_TIPO_EVENTO, logInfo: { ...e.logInfo, RE_DATA_MODIFICACAO: now, RE_USUARIO_LOGADO: currentUser.name } } : e));
                    }
                    handleCancelEdit();
                } else if (type === 'delete') {
                    if (tableName === 'DEPARTAMENTOS') {
                        setMockDepartments(prev => { const newDepts = {...prev}; delete newDepts[record.DE_ID_DEPTO]; return newDepts; });
                    } else if (tableName === 'ACESSO') {
                        setMockAccess(prev => { const newAccess = {...prev}; delete newAccess[record.AC_ID]; return newAccess; });
                    } else { // EVENTOS
                        setMockEvents(mockEvents.filter(e => e.id !== record.RE_ID_EVENTOS));
                    }
                }
                setModalInfo({ isOpen: false });
            };

            const title = `Gerenciar Tabela: ${tableName.charAt(0) + tableName.slice(1).toLowerCase()}`;

            return (
                 <div>
                    <Header title={title} onBack={() => setView('settings')} />
                    <ConfirmationModal modalInfo={modalInfo} onConfirm={handleConfirmAction} onCancel={() => setModalInfo({isOpen: false})} />
                    <UpdateResultModal status={updateStatus} logMessage={logMessage} onRetry={resetAndUpdate} onGoBack={() => setView('settings')} />
                    <main className="p-4 pb-20 max-w-4xl mx-auto">
                        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            
                            {tableName === 'DEPARTAMENTOS' ? (
                                <DepartmentForm newRecordInput={newRecordInput} handleInputChange={handleInputChange} handleAddItem={handleAddItem} />
                            ) : tableName === 'EVENTOS' ? (
                                <EventForm newRecordInput={newRecordInput} handleInputChange={handleInputChange} handleAddItem={handleAddItem} />
                            ) : tableName === 'ACESSO' ? (
                                <AccessForm newRecordInput={newRecordInput} handleInputChange={handleInputChange} handleAddItem={handleAddItem} mockDepartments={mockDepartments} />
                            ) : (
                                <p className="text-center text-gray-500">Tabela não suportada para lançamento: {tableName}</p>
                            )}

                            {newRecords.length > 0 && (
                                <div className="mt-4">
                                    <h4 className="font-semibold text-gray-600 dark:text-gray-400 text-sm mb-2">Registros a serem incluídos:</h4>
                                    <div className="space-y-2">
                                        {newRecords.map(item => (
                                            <div key={item.tempId} className="bg-violet-50 dark:bg-violet-900/50 p-2 rounded-md flex justify-between items-center text-sm">
                                                <span className="font-semibold text-violet-800 dark:text-violet-300">{item.DE_NOME_DEPARTAMENTO || item.EV_NOME_EVENTO || item.AC_LOGIN}</span>
                                                <button onClick={() => handleRemoveNewItem(item.tempId)} className="text-red-500 hover:text-red-700 text-xs font-semibold">REMOVER</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                            
                            <div className="my-8">
                                <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4">Registros Atuais na Tabela</h3>
                                <div className="max-h-96 overflow-y-auto border dark:border-gray-700 rounded-lg">
                                    {tableName === 'DEPARTAMENTOS' ? (
                                        <DepartmentTable records={currentRecords} editingId={editingRecordId} editedData={editedRecordData} onEditChange={handleEditedInputChange} onStartEdit={handleStartEdit} onCancelEdit={handleCancelEdit} setModalInfo={setModalInfo} />
                                    ) : tableName === 'EVENTOS' ? (
                                        <EventTable records={currentRecords} editingId={editingRecordId} editedData={editedRecordData} onEditChange={handleEditedInputChange} onStartEdit={handleStartEdit} onCancelEdit={handleCancelEdit} setModalInfo={setModalInfo}/>
                                    ) : tableName === 'ACESSO' ? (
                                         <AccessTable records={currentRecords} editingId={editingRecordId} editedData={editedRecordData} onEditChange={handleEditedInputChange} onStartEdit={handleStartEdit} onCancelEdit={handleCancelEdit} setModalInfo={setModalInfo} mockDepartments={mockDepartments}/>
                                    ) : (
                                        <p className="p-4 text-center text-gray-500">Nenhum registro para exibir para a tabela {tableName}.</p>
                                    )}
                                </div>
                            </div>
                           
                            <button
                                onClick={handleUpdate}
                                disabled={updateStatus === 'loading' || newRecords.length === 0}
                                className="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition duration-300 shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            >
                                {updateStatus === 'loading' ? (
                                    <><div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div><span>Atualizando...</span></>
                                ) : ( 'Atualizar Tabela com Novos Registros' )}
                            </button>
                        </div>
                    </main>
                </div>
            );
        };
        
        const EventForm = ({ newRecordInput, handleInputChange, handleAddItem }) => (
            <div className="mb-8">
                <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4">Grid de Lançamento</h3>
                <form onSubmit={handleAddItem} className="grid grid-cols-1 md:grid-cols-3 gap-3 items-end bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
                    <div className="md:col-span-1">
                        <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Nome do Evento</label>
                        <input type="text" name="EV_NOME_EVENTO" value={newRecordInput.EV_NOME_EVENTO || ''} onChange={handleInputChange} placeholder="Ex: Culto de Santa Ceia" className="shadow-sm appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-violet-500" />
                    </div>
                    <div className="md:col-span-1">
                        <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Tipo do Evento</label>
                        <input type="text" name="EV_TIPO_EVENTO" value={newRecordInput.EV_TIPO_EVENTO || ''} onChange={handleInputChange} placeholder="Ex: Culto" className="shadow-sm appearance-none border rounded-md w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-violet-500" />
                    </div>
                    <button type="submit" className="md:col-span-1 bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-violet-700 transition h-10">Adicionar à Lista</button>
                </form>
            </div>
        );
        
        const DepartmentForm = ({ newRecordInput, handleInputChange, handleAddItem }) => (
             <div className="mb-8">
                <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4">Grid de Lançamento</h3>
                <form onSubmit={handleAddItem} className="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-1">Nome do Depto.</label><input type="text" name="DE_NOME_DEPARTAMENTO" value={newRecordInput.DE_NOME_DEPARTAMENTO || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                        <div><label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-1">Líder</label><input type="text" name="DE_LIDER_DEPTO" value={newRecordInput.DE_LIDER_DEPTO || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                        <div><label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-1">Associado</label><input type="text" name="DE_ASSOCIADO_DEPTO" value={newRecordInput.DE_ASSOCIADO_DEPTO || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                        <div><label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-1">Ancião Responsável</label><input type="text" name="DE_ANCIAO_LIDER" value={newRecordInput.DE_ANCIAO_LIDER || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                        <div><label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-1">Contato (WhatsApp)</label><input type="tel" name="DE_CONTATO" value={newRecordInput.DE_CONTATO || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                        <div><label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-1">E-mail</label><input type="email" name="DE_EMAIL" value={newRecordInput.DE_EMAIL || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                    </div>
                    <button type="submit" className="w-full bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-violet-700 transition">Adicionar à Lista</button>
                </form>
            </div>
        );
        
        const AccessForm = ({ newRecordInput, handleInputChange, handleAddItem, mockDepartments }) => {
            const approvalOptions = { 'A': 'Ativo', 'P': 'Pendente', 'R': 'Rejeitado', 'I': 'Inativo' };
            const departmentOptions = Object.values(mockDepartments).map(d => d.DE_NOME_DEPARTAMENTO);
            const leaderOptions = [...new Set(Object.values(mockDepartments).map(d => d.DE_LIDER_DEPTO))];

            return (
                 <div className="mb-8">
                    <h3 className="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4">Grid de Lançamento</h3>
                    <form onSubmit={handleAddItem} className="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label className="block text-sm font-bold mb-1 dark:text-gray-300">Login</label><input type="text" name="AC_LOGIN" value={newRecordInput.AC_LOGIN || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                            <div><label className="block text-sm font-bold mb-1 dark:text-gray-300">Senha</label><input type="password" name="AC_SENHA" value={newRecordInput.AC_SENHA || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                            <div><label className="block text-sm font-bold mb-1 dark:text-gray-300">Departamento</label><select name="AC_DEPARTAMENTO" value={newRecordInput.AC_DEPARTAMENTO || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required><option value="">Selecione...</option>{departmentOptions.map(o => <option key={o} value={o}>{o}</option>)}</select></div>
                            <div><label className="block text-sm font-bold mb-1 dark:text-gray-300">Responsável</label><select name="AC_RESP" value={newRecordInput.AC_RESP || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required><option value="">Selecione...</option>{[...new Set(leaderOptions)].map(o => <option key={o} value={o}>{o}</option>)}</select></div>
                            <div><label className="block text-sm font-bold mb-1 dark:text-gray-300">Email</label><input type="email" name="AC_EMAIL" value={newRecordInput.AC_EMAIL || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required /></div>
                            <div><label className="block text-sm font-bold mb-1 dark:text-gray-300">Aprovação</label><select name="AC_APROVACAO" value={newRecordInput.AC_APROVACAO || 'P'} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>{Object.entries(approvalOptions).map(([k, v]) => <option key={k} value={k}>{v}</option>)}</select></div>
                            <div className="md:col-span-2"><label className="block text-sm font-bold mb-1 dark:text-gray-300">Notificação (Ajuda)</label><input type="text" name="AC_NOTIFICACAO" value={newRecordInput.AC_NOTIFICACAO || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></div>
                        </div>
                        <button type="submit" className="w-full bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-violet-700 transition">Adicionar à Lista</button>
                    </form>
                </div>
            );
        };
        
        const EventTable = ({ records, editingId, editedData, onEditChange, onStartEdit, onCancelEdit, setModalInfo }) => (
            <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead className="bg-gray-100 dark:bg-gray-700 sticky top-0">
                    <tr>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">ID Chave</th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">Nome do Evento</th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">Tipo do Evento</th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">Data Lançamento</th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">Data Modificação</th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">Usuário Logado</th>
                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                    </tr>
                </thead>
                <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                    {records.map(record => (
                        <tr key={record.RE_ID_EVENTOS}>
                            <td className="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-500 dark:text-gray-400">{record.RE_ID_EVENTOS}</td>
                            {editingId === record.RE_ID_EVENTOS ? (
                                <>
                                    <td className="px-4 py-2"><input type="text" name="EV_NOME_EVENTO" value={editedData.EV_NOME_EVENTO} onChange={onEditChange} className="w-full border-gray-300 rounded-md shadow-sm text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                    <td className="px-4 py-2"><input type="text" name="EV_TIPO_EVENTO" value={editedData.EV_TIPO_EVENTO} onChange={onEditChange} className="w-full border-gray-300 rounded-md shadow-sm text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                </>
                            ) : (
                                <>
                                    <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200">{record.EV_NOME_EVENTO}</td>
                                    <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.EV_TIPO_EVENTO}</td>
                                </>
                            )}
                            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.RE_DATA_UPDATE}</td>
                            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.RE_DATA_MODIFICACAO}</td>
                            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.RE_USUARIO_LOGADO}</td>
                            <td className="px-4 py-3 whitespace-nowrap text-sm font-medium">
                                {editingId === record.RE_ID_EVENTOS ? (
                                    <div className="flex gap-2">
                                        <button onClick={() => setModalInfo({isOpen: true, type: 'save', record, title: 'Confirmar Alteração', message: 'Deseja salvar as alterações neste registro? A modificação será permanente.', confirmText: 'Salvar', confirmColor: 'bg-green-600'})} className="text-green-600 hover:text-green-900">Salvar</button>
                                        <button onClick={onCancelEdit} className="text-gray-600 hover:text-gray-900">Cancelar</button>
                                    </div>
                                ) : (
                                    <div className="flex gap-4">
                                        <button onClick={() => onStartEdit(record)} className="text-violet-600 hover:text-violet-900" title="Editar"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fillRule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clipRule="evenodd" /></svg></button>
                                        <button onClick={() => setModalInfo({isOpen: true, type: 'delete', record, title: 'Confirmar Exclusão', message: `Deseja excluir permanentemente o registro "${record.EV_NOME_EVENTO}"?`, confirmText: 'Excluir', confirmColor: 'bg-red-600'})} className="text-red-600 hover:text-red-900" title="Excluir"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clipRule="evenodd" /></svg></button>
                                    </div>
                                )}
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        );
        
        const DepartmentTable = ({ records, editingId, editedData, onEditChange, onStartEdit, onCancelEdit, setModalInfo }) => (
             <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead className="bg-gray-100 dark:bg-gray-700 sticky top-0">
                    <tr>
                         {['ID Depto', 'Nome', 'Líder', 'Associado', 'Contato', 'Ancião', 'Email', 'Lançamento', 'Modificação', 'Usuário', 'Ações'].map(h => <th key={h} className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">{h}</th>)}
                    </tr>
                </thead>
                <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                    {records.map(record => (
                        <tr key={record.DE_ID_DEPTO}>
                            <td className="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-500 dark:text-gray-400">{record.DE_ID_DEPTO}</td>
                            {editingId === record.DE_ID_DEPTO ? (
                                <>
                                    <td><input type="text" name="DE_NOME_DEPARTAMENTO" value={editedData.DE_NOME_DEPARTAMENTO} onChange={onEditChange} className="w-full p-1 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                    <td><input type="text" name="DE_LIDER_DEPTO" value={editedData.DE_LIDER_DEPTO} onChange={onEditChange} className="w-full p-1 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                    <td><input type="text" name="DE_ASSOCIADO_DEPTO" value={editedData.DE_ASSOCIADO_DEPTO} onChange={onEditChange} className="w-full p-1 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                    <td><input type="tel" name="DE_CONTATO" value={editedData.DE_CONTATO} onChange={onEditChange} className="w-full p-1 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                    <td><input type="text" name="DE_ANCIAO_LIDER" value={editedData.DE_ANCIAO_LIDER} onChange={onEditChange} className="w-full p-1 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                    <td><input type="email" name="DE_EMAIL" value={editedData.DE_EMAIL} onChange={onEditChange} className="w-full p-1 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                </>
                            ) : (
                                <>
                                    <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.DE_NOME_DEPARTAMENTO}</td>
                                    <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.DE_LIDER_DEPTO}</td>
                                    <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.DE_ASSOCIADO_DEPTO}</td>
                                    <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.DE_CONTATO}</td>
                                    <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.DE_ANCIAO_LIDER}</td>
                                    <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.DE_EMAIL}</td>
                                </>
                            )}
                            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.logInfo.RE_DATA_UPDATE}</td>
                            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.logInfo.RE_DATA_MODIFICACAO}</td>
                            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.logInfo.RE_USUARIO_LOGADO}</td>
                            <td className="px-4 py-3 whitespace-nowrap text-sm font-medium">
                                 {editingId === record.DE_ID_DEPTO ? (
                                    <div className="flex gap-2">
                                        <button onClick={() => setModalInfo({isOpen: true, type: 'save', record, title: 'Confirmar Alteração', message: 'Deseja salvar as alterações neste registro? A modificação será permanente.', confirmText: 'Salvar', confirmColor: 'bg-green-600'})} className="text-green-600 hover:text-green-900">Salvar</button>
                                        <button onClick={onCancelEdit} className="text-gray-600 hover:text-gray-900">Cancelar</button>
                                    </div>
                                ) : (
                                    <div className="flex gap-4">
                                        <button onClick={() => onStartEdit(record)} className="text-violet-600 hover:text-violet-900" title="Editar"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fillRule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clipRule="evenodd" /></svg></button>
                                        <button onClick={() => setModalInfo({isOpen: true, type: 'delete', record, title: 'Confirmar Exclusão', message: `Deseja excluir permanentemente o departamento "${record.DE_NOME_DEPARTAMENTO}"?`, confirmText: 'Excluir', confirmColor: 'bg-red-600'})} className="text-red-600 hover:text-red-900" title="Excluir"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clipRule="evenodd" /></svg></button>
                                    </div>
                                )}
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        );
        
        const AccessTable = ({ records, editingId, editedData, onEditChange, onStartEdit, onCancelEdit, setModalInfo, mockDepartments }) => {
            const approvalOptions = { 'A': 'Ativo', 'P': 'Pendente', 'R': 'Rejeitado', 'I': 'Inativo' };
            const departmentOptions = Object.values(mockDepartments).map(d => d.DE_NOME_DEPARTAMENTO);
            const leaderOptions = [...new Set(Object.values(mockDepartments).map(d => d.DE_LIDER_DEPTO))];

            return (
                <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead className="bg-gray-100 dark:bg-gray-700 sticky top-0">
                        <tr>
                            {['ID', 'Login', 'Departamento', 'Responsável', 'Email', 'Aprovação', 'Notificação', 'Lançamento', 'Modificação', 'Usuário', 'Ações'].map(h => 
                                <th key={h} className="px-4 py-3 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">{h}</th>)}
                        </tr>
                    </thead>
                    <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        {records.map(record => (
                            <tr key={record.AC_ID}>
                                <td className="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-500 dark:text-gray-400">{record.AC_ID}</td>
                                {editingId === record.AC_ID ? (
                                    <>
                                        <td><input type="text" name="AC_LOGIN" value={editedData.AC_LOGIN} onChange={onEditChange} className="w-full p-1 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                        <td><select name="AC_DEPARTAMENTO" value={editedData.AC_DEPARTAMENTO} onChange={onEditChange} className="w-full p-1 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"><option value="">Selecione</option>{departmentOptions.map(o => <option key={o} value={o}>{o}</option>)}</select></td>
                                        <td><select name="AC_RESP" value={editedData.AC_RESP} onChange={onEditChange} className="w-full p-1 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"><option value="">Selecione</option>{leaderOptions.map(o => <option key={o} value={o}>{o}</option>)}</select></td>
                                        <td><input type="email" name="AC_EMAIL" value={editedData.AC_EMAIL} onChange={onEditChange} className="w-full p-1 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                        <td><select name="AC_APROVACAO" value={editedData.AC_APROVACAO} onChange={onEditChange} className="w-full p-1 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white">{Object.entries(approvalOptions).map(([k,v]) => <option key={k} value={k}>{v}</option>)}</select></td>
                                        <td><input type="text" name="AC_NOTIFICACAO" value={editedData.AC_NOTIFICACAO} onChange={onEditChange} className="w-full p-1 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" /></td>
                                    </>
                                ) : (
                                    <>
                                        <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.AC_LOGIN}</td>
                                        <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.AC_DEPARTAMENTO}</td>
                                        <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.AC_RESP}</td>
                                        <td className="px-4 py-3 whitespace-nowrap text-sm dark:text-gray-200">{record.AC_EMAIL}</td>
                                        <td className="px-4 py-3 whitespace-nowrap text-sm"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${record.AC_APROVACAO === 'A' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300'}`}>{approvalOptions[record.AC_APROVACAO]}</span></td>
                                        <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate">{record.AC_NOTIFICACAO}</td>
                                    </>
                                )}
                                <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.logInfo.RE_DATA_UPDATE}</td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.logInfo.RE_DATA_MODIFICACAO}</td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">{record.logInfo.RE_USUARIO_LOGADO}</td>
                                <td className="px-4 py-3 whitespace-nowrap text-sm font-medium">
                                     {editingId === record.AC_ID ? (
                                        <div className="flex gap-2">
                                            <button onClick={() => setModalInfo({isOpen: true, type: 'save', record, title: 'Confirmar Alteração', message: 'Deseja salvar as alterações neste registro? A modificação será permanente.', confirmText: 'Salvar', confirmColor: 'bg-green-600'})} className="text-green-600 hover:text-green-900">Salvar</button>
                                            <button onClick={onCancelEdit} className="text-gray-600 hover:text-gray-900">Cancelar</button>
                                        </div>
                                    ) : (
                                        <div className="flex gap-4">
                                            <button onClick={() => onStartEdit(record)} className="text-violet-600 hover:text-violet-900" title="Editar"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fillRule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clipRule="evenodd" /></svg></button>
                                            <button onClick={() => setModalInfo({isOpen: true, type: 'delete', record, title: 'Confirmar Exclusão', message: `Deseja excluir permanentemente o acesso do usuário "${record.AC_LOGIN}"?`, confirmText: 'Excluir', confirmColor: 'bg-red-600'})} className="text-red-600 hover:text-red-900" title="Excluir"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clipRule="evenodd" /></svg></button>
                                        </div>
                                    )}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            );
        }


        // --- Componente Principal ---
        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [view, setView] = useState('login'); // login, dashboard, ..., settings, manageTable
            const [selectedEventId, setSelectedEventId] = useState(null);
            const [editingEventId, setEditingEventId] = useState(null);
            const [assignments, setAssignments] = useState(MOCK_ASSIGNMENTS);
            const [loading, setLoading] = useState(true);
            const [users, setUsers] = useState(MOCK_USERS_DATA);
            const [mockEvents, setMockEvents] = useState(MOCK_EVENTS_DATA);
            const [mockScales, setMockScales] = useState(MOCK_SCALES_DATA);
            const [mockDepartments, setMockDepartments] = useState(MOCK_DEPARTMENTS_DATA);
            const [mockAccess, setMockAccess] = useState(MOCK_ACCESS_DATA);
            const [managingTable, setManagingTable] = useState(null);
            const [theme, setTheme] = useState('light');

            useEffect(() => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [theme]);

            useEffect(() => {
                setTimeout(() => setLoading(false), 500);
            }, []);
            
            useEffect(() => {
                const manifest = {
                    "name": "Agendei7", "short_name": "Agendei7", "start_url": ".", "display": "standalone",
                    "background_color": "#f3f4f6", "theme_color": "#6d28d9", "description": "Aplicativo para agendamento de escalas.", "icons": []
                };
                const manifestUrl = URL.createObjectURL(new Blob([JSON.stringify(manifest)], { type: 'application/json' }));
                document.querySelector('#manifest').setAttribute('href', manifestUrl);
            }, []);

            const handleLogin = (login, password) => {
                return new Promise(resolve => {
                    setLoading(true);
                    setTimeout(() => {
                        const loginLower = login.toLowerCase();
                        const user = Object.values(users).find(
                            u => (u.id.toLowerCase() === loginLower || u.email.toLowerCase() === loginLower) && u.senha === password
                        );
                        if (user) { setCurrentUser(user); setView('dashboard'); resolve(true); } else { resolve(false); }
                        setLoading(false);
                    }, 500);
                });
            };

            const handleLogout = () => {
                setLoading(true);
                setTimeout(() => {
                    setCurrentUser(null); setView('login'); setLoading(false);
                }, 500);
            };

            const handleUpdateUser = (updatedUser) => {
                 setUsers(prev => ({...prev, [updatedUser.id]: updatedUser }));
                 setCurrentUser(updatedUser);
            };

            const handleUpdatePassword = (newPassword) => {
                const updatedUser = { ...currentUser, senha: newPassword };
                handleUpdateUser(updatedUser);
            }

            if (loading) {
                return ( <div className="min-h-screen flex justify-center items-center"> <div className="loader"></div> </div> );
            }

            const renderView = () => {
                if (!currentUser) return <LoginPage onLogin={handleLogin} />;
                switch (view) {
                    case 'dashboard': return <DashboardPage currentUser={currentUser} setView={setView} setEventId={setSelectedEventId} mockEvents={mockEvents} />;
                    case 'addEvent': return <AddEventPage 
                        setView={setView} 
                        setMockEvents={setMockEvents} 
                        mockEvents={mockEvents} 
                        editingEventId={editingEventId}
                        setEditingEventId={setEditingEventId}
                    />;
                    case 'editScales': return <EditScalesPage 
                        setView={setView} 
                        mockEvents={mockEvents} 
                        setMockEvents={setMockEvents} 
                        setEditingEventId={setEditingEventId}
                    />;
                    case 'generateRoteiro': return <GenerateRoteiroPage setView={setView} mockEvents={mockEvents} mockDepartments={mockDepartments} />;
                    case 'eventDetail': return <EventDetailPage currentUser={currentUser} eventId={selectedEventId} setView={setView} assignments={assignments} setAssignments={setAssignments} mockEvents={mockEvents} mockScales={mockScales} />;
                    case 'calendar': return <CalendarPage currentUser={currentUser} setView={setView} setEventId={setSelectedEventId} mockEvents={mockEvents} />;
                    case 'profile': return <ProfilePage currentUser={currentUser} onLogout={handleLogout} onUpdateUser={handleUpdateUser} setView={setView} />;
                    case 'myScales': return <MyScalesPage currentUser={currentUser} mockEvents={mockEvents} setView={setView} />;
                    case 'departmentData': return <DepartmentDataPage setView={setView} />;
                    case 'settings': return <SettingsPage currentUser={currentUser} setView={setView} setManagingTable={setManagingTable} theme={theme} setTheme={setTheme} onUpdatePassword={handleUpdatePassword} />;
                    case 'manageTable': return <ManageTablePage tableName={managingTable} setView={setView} mockEvents={mockEvents} currentUser={currentUser} setMockEvents={setMockEvents} mockDepartments={mockDepartments} setMockDepartments={setMockDepartments} mockAccess={mockAccess} setMockAccess={setMockAccess} />;
                    default: return <DashboardPage currentUser={currentUser} setView={setView} setEventId={setSelectedEventId} mockEvents={mockEvents} />;
                }
            };
            
            const showNav = currentUser && view !== 'login';

            return (
                <div className="bg-gray-100 dark:bg-gray-900 min-h-screen">
                    {renderView()}
                    {showNav && <BottomNav activeView={view} setView={setView} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

